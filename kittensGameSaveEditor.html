<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Kittens Game 存档编辑器</title>
    <link href="https://cdn.jsdelivr.net/npm/jsoneditor@latest/dist/jsoneditor.min.css" rel="stylesheet" type="text/css">
    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.5.0/libs/lz-string.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsoneditor@latest/dist/jsoneditor.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; }
        #editor { height: 600px; }
        textarea { width: 100%; height: 100px; }
        button { margin: 10px; }
    </style>
</head>
<body>
    <h1>Kittens Game 存档编辑器</h1>
    
    <h2>导入存档 (LZString Base64)</h2>
    <textarea id="base64Input" placeholder="请在此粘贴您的 base64 存档..."></textarea>
    <button onclick="importSave()">导入</button>
    
    <h2>编辑 JSON</h2>
    <div id="editor"></div>
    
    <h2>导出存档</h2>
    <button onclick="exportSave()">导出为 Base64</button>
    <textarea id="base64Output" placeholder="导出的 base64 存档将显示在此..."></textarea>
    <button onclick="downloadSave()">下载为文件</button>
    
    <script>
        // Translation mapping object (fill in your Chinese translations here)
        const translations = {
            // Resources
            "catnip": "猫薄荷",
            "wood": "木材",
            "minerals": "矿物",
            "coal": "煤",
            "iron": "铁",
            "titanium": "钛",
            "gold": "黄金",
            "oil": "石油",
            "uranium": "铀",
            "unobtainium": "难得素",
            "antimatter": "反物质",
            "manpower": "喵力",
            "science": "科学",
            "culture": "文化",
            "faith": "信仰",
            "kittens": "小猫",
            "zebras": "斑马",
            "starchart": "星图",
            "temporalFlux": "时间通量",
            "gflops": "浮点",
            "hashrates": "哈希率",
            "furs": "毛皮",
            "ivory": "象牙",
            "spice": "香料",
            "unicorns": "独角兽",
            "alicorn": "天角兽",
            "necrocorn": "死灵兽",
            "tears": "眼泪",
            "karma": "业",
            "paragon": "燃烧领导力",
            "burnedParagon": "燃烧领导力",
            "timeCrystal": "时间水晶",
            "sorrow": "悲伤",
            "relic": "遗物",
            "void": "虚空产出上限",
            "elderBox": "礼物盒",
            "wrappingPaper": "包装纸",
            "blackcoin": "黑币",
            "bloodstone": "血石",
            "tMythril": "T秘银",
            "beam": "木梁",
            "slab": "石板",
            "plate": "金属板",
            "steel": "钢",
            "concrate": "混凝土",
            "gear": "齿轮",
            "alloy": "合金",
            "eludium": "E合金",
            "scaffold": "脚手架",
            "ship": "船",
            "tanker": "油轮",
            "kerosene": "煤油",
            "parchment": "羊皮纸",
            "manuscript": "手稿",
            "compedium": "概要",
            "blueprint": "蓝图",
            "thorium": "钍",
            "megalith": "巨石",
            // Buildings
            "field": "",
            "pasture": "",
            "aqueduct": "",
            "hut": "",
            "logHouse": "",
            "mansion": "",
            "library": "",
            "academy": "",
            "observatory": "",
            // Add more keys as needed
        };

        // Initialize JSONEditor with custom schema and translation support
        const container = document.getElementById('editor');
        const options = {
            mode: 'tree',
            modes: ['code', 'form', 'text', 'tree', 'view'],
            onError: function (err) {
                alert(err.toString());
            },
            schema: {
                type: 'object',
                properties: {
                    resources: {
                        type: 'array',
                        items: {
                            type: 'object',
                            properties: {
                                name: { type: 'string' },
                                value: { type: 'number' },
                                unlocked: { type: 'boolean' },
                                isHidden: { type: 'boolean' }
                            }
                        }
                    },
                    buildings: {
                        type: 'array',
                        items: {
                            type: 'object',
                            properties: {
                                name: { type: 'string' },
                                val: { type: 'number' },
                                on: { type: 'number' },
                                unlocked: { type: 'boolean' }
                            }
                        }
                    },
                    // Add more schema definitions as needed
                }
            },
            // Use onNodeName to apply translations without breaking tree interactivity
            onNodeName: function (node) {
                const path = node.path;
                if (path.length > 1 && (path[0] === 'resources' || path[0] === 'buildings') && node.field === 'name') {
                    const name = node.value;
                    return translations[name] ? translations[name] : name;
                }
                return node.field;
            }
        };
        const editor = new JSONEditor(container, options);

        function importSave() {
            const base64 = document.getElementById('base64Input').value.trim();
            if (!base64) {
                alert('请粘贴一个 base64 字符串。');
                return;
            }
            try {
                const compressed = LZString.decompressFromBase64(base64);
                const json = JSON.parse(compressed);
                editor.set(json);
                alert('存档导入成功！');
            } catch (e) {
                alert('导入存档失败：' + e.message);
            }
        }

        function exportSave() {
            try {
                const json = editor.get();
                const stringified = JSON.stringify(json);
                const base64 = LZString.compressToBase64(stringified);
                document.getElementById('base64Output').value = base64;
                alert('存档导出成功！');
            } catch (e) {
                alert('导出存档失败：' + e.message);
            }
        }

        function downloadSave() {
            const base64 = document.getElementById('base64Output').value;
            if (!base64) {
                alert('请先导出存档。');
                return;
            }
            const element = document.createElement('a');
            element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(base64));
            element.setAttribute('download', 'kittens-save.txt');
            element.style.display = 'none';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        }
    </script>
</body>
</html>
