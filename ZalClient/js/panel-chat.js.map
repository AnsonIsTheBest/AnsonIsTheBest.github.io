{"version":3,"file":"panel-chat.js","names":["ChatRoom","_PSRoom","options","_options$args","_options$args2","_options$args3","_this","call","classType","users","userCount","onlineUsers","canConnect","pmTarget","challengeMenuOpen","initialSlash","challenging","teamSent","challenged","battle","log","tour","lastMessage","lastMessageTime","joinLeave","userActivity","timeOffset","handleHighlight","args","name","message","serverTime","parseInt","toID","PS","user","userid","startsWith","lastMessageDates","Dex","prefs","set","server","id","lastMessageDate","time","isVisible","getHighlight","mayNotify","notify","title","body","clientCommands","parseClientCommands","chall,challenge","target","_this2","_target$split","split","targetUser","format","undefined","includes","BattleLog","formatId","mainmenu","makeQuery","then","data","rooms","errorReply","join","cancelChallenge","openChallenge","cchall,cancelchallenge","reject","update","sendDirect","clear","_this$log","reset","rank,ranking,rating,ladder","_this3","arg","targets","formatTargeting","formats","gens","i","len","length","$","trim","PSLoginServer","query","Array","isArray","add","buffer","suspect","_i2","item","hiddenFormats","_i4","row","formatid","slice","push","window","escapeFormat","_i6","_ref2","elo","rpr","rprd","gxe","w","l","t","value","escapeHTML","formatName","Math","round","trunc","toFixed","N","COIL_B","parseFloat","pow","formatsText","Object","keys","concat","html","_templateObject","_taggedTemplateLiteralLoose","otherFormats","_templateObject2","registered","routes","play","atQueueEnd","ended","isReplay","pause","ffto,fastfowardto","cmd","parentElem","_this4","prompt","defaultValue","turn","type","okButton","turnNum","send","Number","_this$battle$seeking","seeking","Infinity","isNaN","seekTurn","switchsides","switchViewpoint","cancel,undo","room","choices","request","receiveLine","isDone","isEmpty","BattleChoiceBuilder","move,switch,team,pass,shift,choose","possibleError","addChoice","toString","updateTarget","connect","_inheritsLoose","_proto","prototype","connected","connectWhenLoggedIn","usernames","count","shift","setUsers","addUser","handleJoinLeave","removeUser","renameUser","ChatTournament","loadReplay","updateChallenge","reason","replace","markUserActive","_this$log2","fromUser","noNotify","parseChatMessage","textContent","test","subtleNotify","Date","now","handleReconnect","msg","stepQueue","_this$lastMessage","lines","cutOffStart","cutOffEnd","cutOffTime","cutOffExactLine","reconnectMessage","_i8","_lines2","line","BattleTextParser","parseLine","selfWithGroup","group","charAt","nameWithGroup","roomid","_this$highlightRegExp","_this$highlightRegExp2","highlights","global","noselfhighlight","nameRegExp","_PS$user$nameRegExp","highlightRegExp","updateHighlightRegExp","_unused","globalHighlightsRegExp","roomHighlightsRegExp","RegExp","parseChallenge","challengeString","_splitChallenge$","splitChallenge","challenge","teamFormat","acceptButtonLabel","rejectButtonLabel","_this$args","lastChallenged","idx","indexOf","splice","_this5","filter","Boolean","map","_i10","username","sortOnlineUsers","PSUtils","sortBy","_ref3","getGroup","order","endsWith","index","findIndex","_ref4","curUserid","noUpdate","_ref5","oldUsername","action","silent","_PS$prefs$showjoins","_ref6","_showjoins$this$id","showjoins","leave","messageId","parseNameParts","formattedName","formatJoinLeave","preList","list","named","_i12","j","destroy","_this$log3","PSRoom","CopyableURLBox","_preact$Component","_this6","_len","arguments","_key","apply","copy","input","base","children","select","document","execCommand","_proto2","render","preact","h","readOnly","size","props","url","style","onClick","href","Component","ChatTextEntry","_preact$Component2","_this7","_len2","_key2","subscription","textbox","miniedit","history","historyIndex","tabComplete","height","newHeight","min","max","scrollHeight","focusIfNoSelection","e","tagName","selection","getSelection","elem","focus","onKeyDown","handleKey","onKey","preventDefault","stopImmediatePropagation","_proto3","componentDidMount","_this8","_this$props$room$args","subscribe","forceUpdate","MiniEdit","setContent","text","_textbox$classList","innerHTML","formatText","classList","toggle","setValue","componentWillUnmount","unsubscribe","submit","_this$miniedit","onMessage","getValue","element","historyPush","start","end","_this$textbox$setSele","_this$textbox","setSelectionRange","_ref7","selectionStart","selectionEnd","setSelection","_this$textbox$setSele2","_this$textbox2","replaceSelection","_this$getSelection","newSelection","historyUp","ifSelectionCorrect","_this$getSelection2","newValue","historyDown","_this$getSelection3","duplicateIndex","lastIndexOf","ev","cmdKey","metaKey","ctrlKey","altKey","shiftKey","keyCode","toggleFormatChar","reverse","handleTabComplete","undoTabComplete","panel","onepanel","curLoc","location","newLoc","newIndex","rightRoomList","leftRoomList","miniRoomList","moveRoom","_this$getSelection4","prefix","cursor","candidateIndex","candidates","match1","exec","match2","idprefix","spaceprefix","toLowerCase","prefixIndex","sort","a","b","_userActivity$indexOf","_userActivity$indexOf2","aIndex","bIndex","candidate","getShortName","formatChar","_this$getSelection5","wrap","nesting","OLD_TEXTBOX","left","canTalk","tinyLayout","display","usernameColor","autofocus","rows","onInput","resize","width","padding","placeholder","PSView","focusPreview","ChatTextBox","disabled","_preact$Component3","_this9","_len3","_key3","handleFocus","setTextboxFocused","handleBlur","_proto4","shouldComponentUpdate","nextProps","_classList","_classList2","setAttribute","onFocus","onBlur","ChatPanel","_PSRoomPanel","_this10","_len4","_key4","chatLog","getElementsByClassName","scrollTop","offsetHeight","makeChallenge","team","alert","requestNotifications","packedTeam","privacy","adjustPrivacy","Error","acceptChallenge","_proto5","_this11","subscribeTo","_room$args","_room$tour","_PS$connection","defaultFormat","challengeSent","challengeTo","TeamForm","onSubmit","challengeFrom","PSPanelWrapper","focusClick","fullSize","ChatLog","top","info","isActive","isOffline","connection","reconnectTimer","reconnectDelay","TournamentBox","ChatUserList","minimized","PSRoomPanel","Model","icon","_preact$Component4","_proto6","pmTargetid","Fragment","_ref8","groupSymbol","groups","color","key","_preact$Component5","_this12","_len5","_key5","_proto7","_this13","replaceChild","firstChild","className","noSubscription","backlog","_i14","timestamps","tokens","setControlsJSX","_this$subscription","updateScroll","jsx","controlsElem","removeChild","createElement","appendChild","_this$props$room$log","role","addRoomType"],"sources":["../src/panel-chat.tsx"],"sourcesContent":["/**\r\n * Chat panel\r\n *\r\n * @author Guangcong Luo <guangcongluo@gmail.com>\r\n * @license AGPLv3\r\n */\r\n\r\nimport preact from \"../js/lib/preact\";\r\nimport type { PSSubscription } from \"./client-core\";\r\nimport { PS, PSRoom, type RoomOptions, type RoomID, type Team } from \"./client-main\";\r\nimport { PSView, PSPanelWrapper, PSRoomPanel } from \"./panels\";\r\nimport { TeamForm } from \"./panel-mainmenu\";\r\nimport { BattleLog } from \"./battle-log\";\r\nimport type { Battle } from \"./battle\";\r\nimport { MiniEdit } from \"./miniedit\";\r\nimport { Dex, PSUtils, toID, type ID } from \"./battle-dex\";\r\nimport { BattleTextParser, type Args } from \"./battle-text-parser\";\r\nimport { PSLoginServer } from \"./client-connection\";\r\nimport type { BattleRoom } from \"./panel-battle\";\r\nimport { BattleChoiceBuilder } from \"./battle-choices\";\r\nimport { ChatTournament, TournamentBox } from \"./panel-chat-tournament\";\r\n\r\ndeclare const formatText: any; // from js/server/chat-formatter.js\r\n\r\ntype Challenge = {\r\n\tformatName: string,\r\n\tteamFormat: string,\r\n\tmessage?: string,\r\n\tacceptButtonLabel?: string,\r\n\trejectButtonLabel?: string,\r\n};\r\n\r\nexport class ChatRoom extends PSRoom {\r\n\toverride readonly classType: 'chat' | 'battle' = 'chat';\r\n\t/** note: includes offline users! use onlineUsers if you need onlineUsers */\r\n\tusers: { [userid: string]: string } = {};\r\n\t/** not equal to onlineUsers.length because guests exist */\r\n\tuserCount = 0;\r\n\tonlineUsers: [ID, string][] = [];\r\n\toverride readonly canConnect = true;\r\n\r\n\t// PM-only properties\r\n\tpmTarget: string | null = null;\r\n\tchallengeMenuOpen = false;\r\n\tinitialSlash = false;\r\n\tchallenging: Challenge | null = null;\r\n\t/** True after challenge send/accept before server acknowledgement */\r\n\tteamSent: string | null = null;\r\n\tchallenged: Challenge | null = null;\r\n\t/** n.b. this will be null outside of battle rooms */\r\n\tbattle: Battle | null = null;\r\n\tlog: BattleLog | null = null;\r\n\ttour: ChatTournament | null = null;\r\n\tlastMessage: Args | null = null;\r\n\tlastMessageTime: number | null = null;\r\n\r\n\tjoinLeave: { join: string[], leave: string[], messageId: string } | null = null;\r\n\t/** in order from least to most recent */\r\n\tuserActivity: ID[] = [];\r\n\ttimeOffset = 0;\r\n\tstatic highlightRegExp: Record<string, RegExp | null> | null = null;\r\n\r\n\tconstructor(options: RoomOptions) {\r\n\t\tsuper(options);\r\n\t\tif (options.args?.pmTarget) this.pmTarget = options.args.pmTarget as string;\r\n\t\tif (options.args?.challengeMenuOpen) this.challengeMenuOpen = true;\r\n\t\tif (options.args?.initialSlash) this.initialSlash = true;\r\n\t\tthis.updateTarget(this.pmTarget);\r\n\t\tthis.connect();\r\n\t}\r\n\toverride connect() {\r\n\t\tif (!this.connected || this.connected === 'autoreconnect') {\r\n\t\t\tif (this.pmTarget === null) {\r\n\t\t\t\tPS.send(`/join ${this.id}`);\r\n\t\t\t\tthis.connected = true;\r\n\t\t\t} else {\r\n\t\t\t\tthis.connected = 'client-only';\r\n\t\t\t}\r\n\t\t\tthis.connectWhenLoggedIn = false;\r\n\t\t}\r\n\t}\r\n\toverride receiveLine(args: Args) {\r\n\t\tswitch (args[0]) {\r\n\t\tcase 'users':\r\n\t\t\tconst usernames = args[1].split(',');\r\n\t\t\tconst count = parseInt(usernames.shift()!, 10);\r\n\t\t\tthis.setUsers(count, usernames);\r\n\t\t\treturn;\r\n\r\n\t\tcase 'join': case 'j': case 'J':\r\n\t\t\tthis.addUser(args[1]);\r\n\t\t\tthis.handleJoinLeave(\"join\", args[1], args[0] === \"J\");\r\n\t\t\treturn true;\r\n\r\n\t\tcase 'leave': case 'l': case 'L':\r\n\t\t\tthis.removeUser(args[1]);\r\n\t\t\tthis.handleJoinLeave(\"leave\", args[1], args[0] === \"L\");\r\n\t\t\treturn true;\r\n\r\n\t\tcase 'name': case 'n': case 'N':\r\n\t\t\tthis.renameUser(args[1], args[2]);\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'tournament': case 'tournaments':\r\n\t\t\tthis.tour ||= new ChatTournament(this);\r\n\t\t\tthis.tour.receiveLine(args);\r\n\t\t\treturn;\r\n\r\n\t\tcase 'noinit':\r\n\t\t\tif (this.battle) {\r\n\t\t\t\t// check the Replays database\r\n\t\t\t\t(this as any as BattleRoom).loadReplay();\r\n\t\t\t} else {\r\n\t\t\t\tthis.receiveLine(['bigerror', 'Room does not exist']);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\tcase 'expire':\r\n\t\t\tthis.connected = 'expired';\r\n\t\t\tthis.receiveLine(['', `This room has expired (you can't chat in it anymore)`]);\r\n\t\t\treturn;\r\n\r\n\t\tcase 'chat': case 'c':\r\n\t\t\tif (`${args[2]} `.startsWith('/challenge ')) {\r\n\t\t\t\tthis.updateChallenge(args[1], args[2].slice(11));\r\n\t\t\t\treturn;\r\n\t\t\t} else if (args[2].startsWith('/warn ')) {\r\n\t\t\t\tconst reason = args[2].replace('/warn ', '');\r\n\t\t\t\tPS.join(`rules-warn` as RoomID, {\r\n\t\t\t\t\targs: {\r\n\t\t\t\t\t\ttype: 'warn',\r\n\t\t\t\t\t\tmessage: reason?.trim() || undefined,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tparentElem: null,\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t// falls through\r\n\t\tcase 'c:':\r\n\t\t\tif (args[0] === 'c:') PS.lastMessageTime = args[1];\r\n\t\t\tthis.lastMessage = args;\r\n\t\t\tthis.joinLeave = null;\r\n\t\t\tconst name = args[args[0] === 'c:' ? 2 : 1];\r\n\t\t\tthis.markUserActive(name);\r\n\t\t\tif (this.tour) this.tour.joinLeave = null;\r\n\t\t\tif (this.id.startsWith(\"dm-\")) {\r\n\t\t\t\tconst fromUser = args[args[0] === 'c:' ? 2 : 1];\r\n\t\t\t\tif (toID(fromUser) === PS.user.userid) break;\r\n\t\t\t\tconst message = args[args[0] === 'c:' ? 3 : 2];\r\n\t\t\t\tconst noNotify = this.log?.parseChatMessage(message, name, args[1])?.[2];\r\n\t\t\t\tif (!noNotify) {\r\n\t\t\t\t\tlet textContent = message;\r\n\t\t\t\t\tif (/^\\/(log|raw|html|uhtml|uhtmlchange) /.test(message)) {\r\n\t\t\t\t\t\ttextContent = message.split(' ').slice(1).join(' ')\r\n\t\t\t\t\t\t\t.replace(/<[^>]*?>/g, '');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.notify({\r\n\t\t\t\t\t\ttitle: `${this.title}`,\r\n\t\t\t\t\t\tbody: textContent,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.subtleNotify();\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase ':':\r\n\t\t\tthis.timeOffset = Math.trunc(Date.now() / 1000) - (parseInt(args[1], 10) || 0);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tsuper.receiveLine(args);\r\n\t}\r\n\toverride handleReconnect(msg: string): boolean | void {\r\n\t\tif (this.battle) {\r\n\t\t\tthis.battle.reset();\r\n\t\t\tthis.battle.stepQueue = [];\r\n\t\t\treturn false;\r\n\t\t} else {\r\n\t\t\tlet lines = msg.split('\\n');\r\n\r\n\t\t\t// cut off starting lines until we get to PS.lastMessage timestamp\r\n\t\t\t// then cut off roomintro from the end\r\n\t\t\tlet cutOffStart = 0;\r\n\t\t\tlet cutOffEnd = lines.length;\r\n\t\t\tconst cutOffTime = parseInt(PS.lastMessageTime);\r\n\t\t\tconst cutOffExactLine = this.lastMessage ? '|' + this.lastMessage?.join('|') : '';\r\n\t\t\tlet reconnectMessage = '|raw|<div class=\"infobox\">You reconnected.</div>';\r\n\t\t\tfor (let i = 0; i < lines.length; i++) {\r\n\t\t\t\tif (lines[i].startsWith('|users|')) {\r\n\t\t\t\t\tthis.add(lines[i]);\r\n\t\t\t\t}\r\n\t\t\t\tif (lines[i] === cutOffExactLine) {\r\n\t\t\t\t\tcutOffStart = i + 1;\r\n\t\t\t\t} else if (lines[i].startsWith(`|c:|`)) {\r\n\t\t\t\t\tconst time = parseInt(lines[i].split('|')[2] || '');\r\n\t\t\t\t\tif (time < cutOffTime) cutOffStart = i;\r\n\t\t\t\t}\r\n\t\t\t\tif (lines[i].startsWith('|raw|<div class=\"infobox\"> You joined ')) {\r\n\t\t\t\t\treconnectMessage = `|raw|<div class=\"infobox\">You reconnected to ${lines[i].slice(38)}`;\r\n\t\t\t\t\tcutOffEnd = i;\r\n\t\t\t\t\tif (!lines[i - 1]) cutOffEnd = i - 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlines = lines.slice(cutOffStart, cutOffEnd);\r\n\r\n\t\t\tif (lines.length) {\r\n\t\t\t\tthis.receiveLine([`raw`, `<div class=\"infobox\">You disconnected.</div>`]);\r\n\t\t\t\tfor (const line of lines) this.receiveLine(BattleTextParser.parseLine(line));\r\n\t\t\t\tthis.receiveLine(BattleTextParser.parseLine(reconnectMessage));\r\n\t\t\t}\r\n\t\t\tthis.update(null);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\tupdateTarget(name?: string | null) {\r\n\t\tconst selfWithGroup = `${PS.user.group || ' '}${PS.user.name}`;\r\n\t\tif (this.id === 'dm-') {\r\n\t\t\tthis.pmTarget = selfWithGroup;\r\n\t\t\tthis.setUsers(1, [selfWithGroup]);\r\n\t\t\tthis.title = `Console`;\r\n\t\t} else if (this.id.startsWith('dm-')) {\r\n\t\t\tconst id = this.id.slice(3);\r\n\t\t\tif (toID(name) !== id) name = null;\r\n\t\t\tname ||= this.pmTarget || id;\r\n\t\t\tif (/[A-Za-z0-9]/.test(name.charAt(0))) name = ` ${name}`;\r\n\t\t\tconst nameWithGroup = name;\r\n\t\t\tname = name.slice(1);\r\n\t\t\tthis.pmTarget = name;\r\n\t\t\tif (!PS.user.userid) {\r\n\t\t\t\tthis.setUsers(1, [nameWithGroup]);\r\n\t\t\t} else {\r\n\t\t\t\tthis.setUsers(2, [nameWithGroup, selfWithGroup]);\r\n\t\t\t}\r\n\t\t\tthis.title = `[DM] ${nameWithGroup.trim()}`;\r\n\t\t}\r\n\t}\r\n\tstatic getHighlight(message: string, roomid: string) {\r\n\t\tlet highlights = PS.prefs.highlights || {};\r\n\t\tif (Array.isArray(highlights)) {\r\n\t\t\thighlights = { global: highlights };\r\n\t\t\t// Migrate from the old highlight system\r\n\t\t\tPS.prefs.set('highlights', highlights);\r\n\t\t}\r\n\t\tif (!PS.prefs.noselfhighlight && PS.user.nameRegExp) {\r\n\t\t\tif (PS.user.nameRegExp?.test(message)) return true;\r\n\t\t}\r\n\t\tif (!this.highlightRegExp) {\r\n\t\t\ttry {\r\n\t\t\t\tthis.updateHighlightRegExp(highlights);\r\n\t\t\t} catch {\r\n\t\t\t\t// If the expression above is not a regexp, we'll get here.\r\n\t\t\t\t// Don't throw an exception because that would prevent the chat\r\n\t\t\t\t// message from showing up, or, when the lobby is initialising,\r\n\t\t\t\t// it will prevent the initialisation from completing.\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst id = PS.server.id + '#' + roomid;\r\n\t\tconst globalHighlightsRegExp = this.highlightRegExp?.['global'];\r\n\t\tconst roomHighlightsRegExp = this.highlightRegExp?.[id];\r\n\t\treturn (((globalHighlightsRegExp?.test(message)) || (roomHighlightsRegExp?.test(message))));\r\n\t}\r\n\tstatic updateHighlightRegExp(highlights: Record<string, string[]>) {\r\n\t\t// Enforce boundary for match sides, if a letter on match side is\r\n\t\t// a word character. For example, regular expression \"a\" matches\r\n\t\t// \"a\", but not \"abc\", while regular expression \"!\" matches\r\n\t\t// \"!\" and \"!abc\".\r\n\t\tthis.highlightRegExp = {};\r\n\t\tfor (let i in highlights) {\r\n\t\t\tif (!highlights[i].length) {\r\n\t\t\t\tthis.highlightRegExp[i] = null;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tthis.highlightRegExp[i] = new RegExp('(?:\\\\b|(?!\\\\w))(?:' + highlights[i].join('|') + ')(?:\\\\b|(?!\\\\w))', 'i');\r\n\t\t}\r\n\t}\r\n\thandleHighlight = (args: Args) => {\r\n\t\tlet name;\r\n\t\tlet message;\r\n\t\tlet serverTime = 0;\r\n\t\tif (args[0] === 'c:') {\r\n\t\t\tserverTime = parseInt(args[1]);\r\n\t\t\tname = args[2];\r\n\t\t\tmessage = args[3];\r\n\t\t} else {\r\n\t\t\tname = args[1];\r\n\t\t\tmessage = args[2];\r\n\t\t}\r\n\t\tif (toID(name) === PS.user.userid) return false;\r\n\t\tif (message.startsWith(`/raw `) || message.startsWith(`/uhtml`) || message.startsWith(`/uhtmlchange`)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tconst lastMessageDates = Dex.prefs('logtimes') || (PS.prefs.set('logtimes', {}), Dex.prefs('logtimes'));\r\n\t\tif (!lastMessageDates[PS.server.id]) lastMessageDates[PS.server.id] = {};\r\n\t\tconst lastMessageDate = lastMessageDates[PS.server.id][this.id] || 0;\r\n\t\t// because the time offset to the server can vary slightly, subtract it to not have it affect comparisons between dates\r\n\t\tconst time = serverTime - (this.timeOffset || 0);\r\n\t\tif (PS.isVisible(this)) {\r\n\t\t\tthis.lastMessageTime = null;\r\n\t\t\tlastMessageDates[PS.server.id][this.id] = time;\r\n\t\t\tPS.prefs.set('logtimes', lastMessageDates);\r\n\t\t} else {\r\n\t\t\t// To be saved on focus\r\n\t\t\tconst lastMessageTime = this.lastMessageTime || 0;\r\n\t\t\tif (lastMessageTime < time) this.lastMessageTime = time;\r\n\t\t}\r\n\t\tif (ChatRoom.getHighlight(message, this.id)) {\r\n\t\t\tconst mayNotify = time > lastMessageDate;\r\n\t\t\tif (mayNotify) this.notify({\r\n\t\t\t\ttitle: `Mentioned by ${name} in ${this.id}`,\r\n\t\t\t\tbody: `\"${message}\"`,\r\n\t\t\t\tid: 'highlight',\r\n\t\t\t});\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t};\r\n\toverride clientCommands = this.parseClientCommands({\r\n\t\t'chall,challenge'(target) {\r\n\t\t\tif (target) {\r\n\t\t\t\tlet [targetUser, format] = target.split(',');\r\n\t\t\t\tif (this.pmTarget && (format === undefined || targetUser.includes('@@@'))) {\r\n\t\t\t\t\tformat = target;\r\n\t\t\t\t\ttargetUser = this.pmTarget;\r\n\t\t\t\t}\r\n\t\t\t\tformat = BattleLog.formatId(format || '');\r\n\t\t\t\tPS.mainmenu.makeQuery('userdetails', targetUser).then(data => {\r\n\t\t\t\t\tif (data.rooms === false) return this.errorReply('This player does not exist or is not online.');\r\n\t\t\t\t\tPS.join(`challenge-${toID(targetUser)}` as RoomID, { args: { format } });\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (this.challengeMenuOpen) {\r\n\t\t\t\tthis.cancelChallenge();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.openChallenge();\r\n\t\t},\r\n\t\t'cchall,cancelchallenge'(target) {\r\n\t\t\tthis.cancelChallenge();\r\n\t\t},\r\n\t\t'reject'(target) {\r\n\t\t\tthis.challenged = null;\r\n\t\t\tthis.teamSent = null;\r\n\t\t\tthis.update(null);\r\n\t\t\tthis.sendDirect(`/reject ${target}`);\r\n\t\t},\r\n\t\t'clear'() {\r\n\t\t\tthis.log?.reset();\r\n\t\t\tthis.update(null);\r\n\t\t},\r\n\t\t'rank,ranking,rating,ladder'(target) {\r\n\t\t\tlet arg = target;\r\n\t\t\tif (!arg) {\r\n\t\t\t\targ = PS.user.userid;\r\n\t\t\t}\r\n\t\t\tif (this.battle && !arg.includes(',')) {\r\n\t\t\t\targ += \", \" + this.id.split('-')[1];\r\n\t\t\t}\r\n\r\n\t\t\tconst targets = arg.split(',');\r\n\t\t\tlet formatTargeting = false;\r\n\t\t\tconst formats: { [key: string]: number } = {};\r\n\t\t\tconst gens: { [key: string]: number } = {};\r\n\t\t\tfor (let i = 1, len = targets.length; i < len; i++) {\r\n\t\t\t\ttargets[i] = $.trim(targets[i]);\r\n\t\t\t\tif (targets[i].length === 4 && targets[i].startsWith('gen')) {\r\n\t\t\t\t\tgens[targets[i]] = 1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tformats[toID(targets[i])] = 1;\r\n\t\t\t\t}\r\n\t\t\t\tformatTargeting = true;\r\n\t\t\t}\r\n\r\n\t\t\tPSLoginServer.query(\"ladderget\", {\r\n\t\t\t\tuser: targets[0],\r\n\t\t\t}).then(data => {\r\n\t\t\t\tif (!data || !Array.isArray(data)) return this.add(`|error|Error: corrupted ranking data`);\r\n\t\t\t\tlet buffer = `<div class=\"ladder\"><table><tr><td colspan=\"9\">User: <strong>${toID(targets[0])}</strong></td></tr>`;\r\n\t\t\t\tif (!data.length) {\r\n\t\t\t\t\tbuffer += '<tr><td colspan=\"9\"><em>This user has not played any ladder games yet.</em></td></tr>';\r\n\t\t\t\t\tbuffer += '</table></div>';\r\n\t\t\t\t\treturn this.add(`|html|${buffer}`);\r\n\t\t\t\t}\r\n\t\t\t\tbuffer += '<tr><th>Format</th><th><abbr title=\"Elo rating\">Elo</abbr></th><th><abbr title=\"user\\'s percentage chance of winning a random battle (aka GLIXARE)\">GXE</abbr></th><th><abbr title=\"Glicko-1 rating: rating &#177; deviation\">Glicko-1</abbr></th><th>COIL</th><th>W</th><th>L</th><th>Total</th>';\r\n\t\t\t\tlet suspect = false;\r\n\t\t\t\tfor (const item of data) {\r\n\t\t\t\t\tif ('suspect' in item) suspect = true;\r\n\t\t\t\t}\r\n\t\t\t\tif (suspect) buffer += '<th>Suspect reqs possible?</th>';\r\n\t\t\t\tbuffer += '</tr>';\r\n\t\t\t\tconst hiddenFormats = [];\r\n\t\t\t\tfor (const row of data) {\r\n\t\t\t\t\tif (!row) return this.add(`|error|Error: corrupted ranking data`);\r\n\t\t\t\t\tconst formatId = toID(row.formatid);\r\n\t\t\t\t\tif (!formatTargeting ||\r\n\t\t\t\t\t\tformats[formatId] ||\r\n\t\t\t\t\t\tgens[formatId.slice(0, 4)] ||\r\n\t\t\t\t\t\t(gens['gen6'] && !formatId.startsWith('gen'))) {\r\n\t\t\t\t\t\tbuffer += '<tr>';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tbuffer += '<tr class=\"hidden\">';\r\n\t\t\t\t\t\thiddenFormats.push(window.BattleLog.escapeFormat(formatId, true));\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Validate all the numerical data\r\n\t\t\t\t\tfor (const value of [row.elo, row.rpr, row.rprd, row.gxe, row.w, row.l, row.t]) {\r\n\t\t\t\t\t\tif (typeof value !== 'number' && typeof value !== 'string') {\r\n\t\t\t\t\t\t\treturn this.add(`|error|Error: corrupted ranking data`);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbuffer += `<td> ${BattleLog.escapeHTML(BattleLog.formatName(formatId, true))} </td><td><strong>${Math.round(row.elo)}</strong></td>`;\r\n\t\t\t\t\tif (row.rprd > 100) {\r\n\t\t\t\t\t\t// High rating deviation. Provisional rating.\r\n\t\t\t\t\t\tbuffer += `<td>&ndash;</td>`;\r\n\t\t\t\t\t\tbuffer += `<td><span style=\"color:#888\"><em>${Math.round(row.rpr)} <small> &#177; ${Math.round(row.rprd)} </small></em> <small>(provisional)</small></span></td>`;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tbuffer += `<td>${Math.trunc(row.gxe)}<small>.${row.gxe.toFixed(1).slice(-1)}%</small></td>`;\r\n\t\t\t\t\t\tbuffer += `<td><em>${Math.round(row.rpr)} <small> &#177; ${Math.round(row.rprd)}</small></em></td>`;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst N = parseInt(row.w, 10) + parseInt(row.l, 10) + parseInt(row.t, 10);\r\n\t\t\t\t\tconst COIL_B = undefined;\r\n\r\n\t\t\t\t\t// Uncomment this after LadderRoom logic is implemented\r\n\t\t\t\t\t// COIL_B = LadderRoom?.COIL_B[formatId];\r\n\r\n\t\t\t\t\tif (COIL_B) {\r\n\t\t\t\t\t\tbuffer += `<td>${Math.round(40.0 * parseFloat(row.gxe) * 2.0 ** (-COIL_B / N))}</td>`;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tbuffer += '<td>&mdash;</td>';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbuffer += `<td> ${row.w} </td><td> ${row.l} </td><td> ${N} </td>`;\r\n\t\t\t\t\tif (suspect) {\r\n\t\t\t\t\t\tif (typeof row.suspect === 'undefined') {\r\n\t\t\t\t\t\t\tbuffer += '<td>&mdash;</td>';\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tbuffer += '<td>';\r\n\t\t\t\t\t\t\tbuffer += (row.suspect ? \"Yes\" : \"No\");\r\n\t\t\t\t\t\t\tbuffer += '</td>';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbuffer += '</tr>';\r\n\t\t\t\t}\r\n\t\t\t\tif (hiddenFormats.length) {\r\n\t\t\t\t\tif (hiddenFormats.length === data.length) {\r\n\t\t\t\t\t\tconst formatsText = Object.keys(gens).concat(Object.keys(formats)).join(', ');\r\n\t\t\t\t\t\tbuffer += `<tr class=\"no-matches\"><td colspan=\"8\">` +\r\n\t\t\t\t\t\t\tBattleLog.html`<em>This user has not played any ladder games that match ${formatsText}.</em></td></tr>`;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst otherFormats = hiddenFormats.slice(0, 3).join(', ') +\r\n\t\t\t\t\t\t(hiddenFormats.length > 3 ? ` and ${hiddenFormats.length - 3} other formats` : '');\r\n\t\t\t\t\tbuffer += `<tr><td colspan=\"8\"><button name=\"showOtherFormats\">` +\r\n\t\t\t\t\t\tBattleLog.html`${otherFormats} not shown</button></td></tr>`;\r\n\t\t\t\t}\r\n\t\t\t\tlet userid = toID(targets[0]);\r\n\t\t\t\tlet registered = PS.user.registered;\r\n\t\t\t\tif (registered && PS.user.userid === userid) {\r\n\t\t\t\t\tbuffer += `<tr><td colspan=\"8\" style=\"text-align:right\"><a href=\"//${PS.routes.users}/${userid}\">Reset W/L</a></tr></td>`;\r\n\t\t\t\t}\r\n\t\t\t\tbuffer += '</table></div>';\r\n\t\t\t\tthis.add(`|html|${buffer}`);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t// battle-specific commands\r\n\t\t// ------------------------\r\n\t\t'play'() {\r\n\t\t\tif (!this.battle) return this.add('|error|You are not in a battle');\r\n\t\t\tif (this.battle.atQueueEnd) {\r\n\t\t\t\tif (this.battle.ended) this.battle.isReplay = true;\r\n\t\t\t\tthis.battle.reset();\r\n\t\t\t}\r\n\t\t\tthis.battle.play();\r\n\t\t\tthis.update(null);\r\n\t\t},\r\n\t\t'pause'() {\r\n\t\t\tif (!this.battle) return this.add('|error|You are not in a battle');\r\n\t\t\tthis.battle.pause();\r\n\t\t\tthis.update(null);\r\n\t\t},\r\n\t\t'ffto,fastfowardto'(target, cmd, parentElem) {\r\n\t\t\tif (!this.battle) return this.add('|error|You are not in a battle');\r\n\t\t\tif (!target) {\r\n\t\t\t\tPS.prompt(\"Turn number?\", {\r\n\t\t\t\t\tdefaultValue: `${this.battle.turn}`,\r\n\t\t\t\t\ttype: 'numeric',\r\n\t\t\t\t\tokButton: 'Go',\r\n\t\t\t\t\tparentElem,\r\n\t\t\t\t}).then(turnNum => {\r\n\t\t\t\t\tif (turnNum?.trim()) this.send(`/ffto ${turnNum}`, parentElem);\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet turnNum = Number(target);\r\n\t\t\tif (target.startsWith('+') || turnNum < 0) {\r\n\t\t\t\tturnNum += this.battle.seeking ?? this.battle.turn;\r\n\t\t\t\tif (turnNum < 0) turnNum = 0;\r\n\t\t\t} else if (target === 'end') {\r\n\t\t\t\tturnNum = Infinity;\r\n\t\t\t}\r\n\t\t\tif (isNaN(turnNum)) {\r\n\t\t\t\tthis.errorReply(`Invalid turn number: ${target}`);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.battle.seekTurn(turnNum);\r\n\t\t\tthis.update(null);\r\n\t\t},\r\n\t\t'switchsides'() {\r\n\t\t\tif (!this.battle) return this.add('|error|You are not in a battle');\r\n\t\t\tthis.battle.switchViewpoint();\r\n\t\t},\r\n\t\t'cancel,undo'() {\r\n\t\t\tif (!this.battle) return this.send('/cancelchallenge');\r\n\r\n\t\t\tconst room = this as any as BattleRoom;\r\n\t\t\tif (!room.choices || !room.request) {\r\n\t\t\t\tthis.receiveLine([`error`, `/choose - You are not a player in this battle`]);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (room.choices.isDone() || room.choices.isEmpty()) {\r\n\t\t\t\t// we _could_ check choices.noCancel, but the server will check anyway\r\n\t\t\t\tthis.sendDirect('/undo');\r\n\t\t\t}\r\n\t\t\troom.choices = new BattleChoiceBuilder(room.request);\r\n\t\t\tthis.update(null);\r\n\t\t},\r\n\t\t'move,switch,team,pass,shift,choose'(target, cmd) {\r\n\t\t\tif (!this.battle) return this.add('|error|You are not in a battle');\r\n\t\t\tconst room = this as any as BattleRoom;\r\n\t\t\tif (!room.choices) {\r\n\t\t\t\tthis.receiveLine([`error`, `/choose - You are not a player in this battle`]);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (cmd !== 'choose') target = `${cmd} ${target}`;\r\n\t\t\tif (target === 'choose auto' || target === 'choose default') {\r\n\t\t\t\tthis.sendDirect('/choose default');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst possibleError = room.choices.addChoice(target);\r\n\t\t\tif (possibleError) {\r\n\t\t\t\tthis.errorReply(possibleError);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (room.choices.isDone()) this.sendDirect(`/choose ${room.choices.toString()}`);\r\n\t\t\tthis.update(null);\r\n\t\t},\r\n\t});\r\n\topenChallenge() {\r\n\t\tif (!this.pmTarget) {\r\n\t\t\tthis.add(`|error|Can only be used in a PM.`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.challengeMenuOpen = true;\r\n\t\tthis.update(null);\r\n\t}\r\n\tcancelChallenge() {\r\n\t\tif (!this.pmTarget) {\r\n\t\t\tthis.add(`|error|Can only be used in a PM.`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif ((this.teamSent && this.challengeMenuOpen) || this.challenging) {\r\n\t\t\tthis.sendDirect('/cancelchallenge');\r\n\t\t\tthis.challenging = null;\r\n\t\t\tthis.challengeMenuOpen = true;\r\n\t\t} else {\r\n\t\t\tthis.challengeMenuOpen = false;\r\n\t\t}\r\n\t\tthis.challenging = null;\r\n\t\tthis.teamSent = null;\r\n\t\tthis.update(null);\r\n\t}\r\n\tparseChallenge(challengeString: string | null): Challenge | null {\r\n\t\tif (!challengeString) return null;\r\n\r\n\t\tlet splitChallenge = challengeString.split('|');\r\n\r\n\t\tconst challenge = {\r\n\t\t\tformatName: splitChallenge[0],\r\n\t\t\tteamFormat: splitChallenge[1] ?? splitChallenge[0],\r\n\t\t\tmessage: splitChallenge[2],\r\n\t\t\tacceptButtonLabel: splitChallenge[3],\r\n\t\t\trejectButtonLabel: splitChallenge[4],\r\n\t\t};\r\n\t\tif (!challenge.formatName && !challenge.message) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn challenge;\r\n\t}\r\n\tupdateChallenge(name: string, challengeString: string) {\r\n\t\tconst challenge = this.parseChallenge(challengeString);\r\n\t\tconst userid = toID(name);\r\n\t\tif (this.args?.format) this.args.format = null;\r\n\t\tthis.teamSent = null;\r\n\r\n\t\t// Protocol documentation: https://github.com/smogon/pokemon-showdown-client/pull/1799\r\n\r\n\t\tif (!challenge) {\r\n\t\t\t// rejected or canceled.\r\n\t\t\t// plausibly due to a server bug, SENDER may be wrong in this case\r\n\t\t\t// (when we reject, we are SENDER; when we cancel, we are not)\r\n\t\t\tthis.challenged = null;\r\n\t\t\tthis.challenging = null;\r\n\t\t} else if (userid === PS.user.userid) {\r\n\t\t\t// we are SENDER\r\n\t\t\tthis.challenging = challenge;\r\n\t\t\tthis.challengeMenuOpen = false;\r\n\t\t\tPS.mainmenu.lastChallenged = Date.now();\r\n\t\t} else {\r\n\t\t\t// we are RECEIVER\r\n\t\t\tthis.challenged = challenge;\r\n\t\t\tthis.notify({\r\n\t\t\t\ttitle: `Challenge from ${name}`,\r\n\t\t\t\tbody: `Format: ${BattleLog.formatName(challenge.formatName)}`,\r\n\t\t\t\tid: 'challenge',\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis.update(null);\r\n\t}\r\n\tmarkUserActive(name: string) {\r\n\t\tconst userid = toID(name);\r\n\t\tconst idx = this.userActivity.indexOf(userid);\r\n\t\tthis.users[userid] = name;\r\n\t\tif (idx !== -1) {\r\n\t\t\tthis.userActivity.splice(idx, 1);\r\n\t\t}\r\n\t\tthis.userActivity.push(userid);\r\n\t\tif (this.userActivity.length > 100) {\r\n\t\t\t// Prune the list\r\n\t\t\tthis.userActivity.splice(0, 20);\r\n\t\t}\r\n\t}\r\n\toverride sendDirect(line: string) {\r\n\t\tif (this.pmTarget) {\r\n\t\t\tline = line.split('\\n').filter(Boolean).map(row => `/pm ${this.pmTarget!}, ${row}`).join('\\n');\r\n\t\t\tPS.send(line);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tsuper.sendDirect(line);\r\n\t}\r\n\tsetUsers(count: number, usernames: string[]) {\r\n\t\tthis.userCount = count;\r\n\t\tthis.onlineUsers = [];\r\n\t\tfor (const username of usernames) {\r\n\t\t\tconst userid = toID(username);\r\n\t\t\tthis.users[userid] = username;\r\n\t\t\tthis.onlineUsers.push([userid, username]);\r\n\t\t}\r\n\t\tthis.sortOnlineUsers();\r\n\t\tthis.update(null);\r\n\t}\r\n\tsortOnlineUsers() {\r\n\t\tPSUtils.sortBy(this.onlineUsers, ([id, name]) => (\r\n\t\t\t[PS.server.getGroup(name.charAt(0)).order, !name.endsWith('@!'), id]\r\n\t\t));\r\n\t}\r\n\taddUser(username: string) {\r\n\t\tif (!username) return;\r\n\r\n\t\tconst userid = toID(username);\r\n\t\tthis.users[userid] = username;\r\n\t\tconst index = this.onlineUsers.findIndex(([curUserid]) => curUserid === userid);\r\n\t\tif (index >= 0) {\r\n\t\t\tthis.onlineUsers[index] = [userid, username];\r\n\t\t} else {\r\n\t\t\tthis.userCount++;\r\n\t\t\tthis.onlineUsers.push([userid, username]);\r\n\t\t\tthis.sortOnlineUsers();\r\n\t\t}\r\n\t\tthis.update(null);\r\n\t}\r\n\tremoveUser(username: string, noUpdate?: boolean) {\r\n\t\tif (!username) return;\r\n\r\n\t\tconst userid = toID(username);\r\n\t\tconst index = this.onlineUsers.findIndex(([curUserid]) => curUserid === userid);\r\n\t\tif (index >= 0) {\r\n\t\t\tthis.userCount--;\r\n\t\t\tthis.onlineUsers.splice(index, 1);\r\n\t\t\tif (!noUpdate) this.update(null);\r\n\t\t}\r\n\t}\r\n\trenameUser(username: string, oldUsername: string) {\r\n\t\tthis.removeUser(oldUsername, true);\r\n\t\tthis.addUser(username);\r\n\t\tthis.update(null);\r\n\t}\r\n\r\n\thandleJoinLeave(action: 'join' | 'leave', name: string, silent: boolean) {\r\n\t\tif (action === 'join') {\r\n\t\t\tthis.addUser(name);\r\n\t\t} else if (action === 'leave') {\r\n\t\t\tthis.removeUser(name);\r\n\t\t}\r\n\t\tconst showjoins = PS.prefs.showjoins?.[PS.server.id];\r\n\t\tif (!(showjoins?.[this.id] ?? showjoins?.['global'] ?? !silent)) return;\r\n\r\n\t\tthis.joinLeave ||= {\r\n\t\t\tjoin: [],\r\n\t\t\tleave: [],\r\n\t\t\tmessageId: `joinleave-${Date.now()}`,\r\n\t\t};\r\n\t\tconst user = BattleTextParser.parseNameParts(name);\r\n\t\tconst formattedName = user.group + user.name;\r\n\t\tif (action === 'join' && this.joinLeave['leave'].includes(formattedName)) {\r\n\t\t\tthis.joinLeave['leave'].splice(this.joinLeave['leave'].indexOf(formattedName), 1);\r\n\t\t} else if (action === 'leave' && this.joinLeave['join'].includes(formattedName)) {\r\n\t\t\tthis.joinLeave['join'].splice(this.joinLeave['join'].indexOf(formattedName), 1);\r\n\t\t} else {\r\n\t\t\tthis.joinLeave[action].push(formattedName);\r\n\t\t}\r\n\r\n\t\tlet message = this.formatJoinLeave(this.joinLeave['join'], 'joined');\r\n\t\tif (this.joinLeave['join'].length && this.joinLeave['leave'].length) message += '; ';\r\n\t\tmessage += this.formatJoinLeave(this.joinLeave['leave'], 'left');\r\n\r\n\t\tthis.add(`|uhtml|${this.joinLeave.messageId}|<small style=\"color: #555555\">${message}</small>`);\r\n\t}\r\n\r\n\tformatJoinLeave(preList: string[], action: 'joined' | 'left') {\r\n\t\tif (!preList.length) return '';\r\n\r\n\t\tlet message = '';\r\n\t\tlet list: string[] = [];\r\n\t\tlet named: { [key: string]: boolean } = {};\r\n\t\tfor (let item of preList) {\r\n\t\t\tif (!named[item]) list.push(item);\r\n\t\t\tnamed[item] = true;\r\n\t\t}\r\n\t\tfor (let j = 0; j < list.length; j++) {\r\n\t\t\tif (j >= 5) {\r\n\t\t\t\tmessage += `, and ${(list.length - 5)} others`;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif (j > 0) {\r\n\t\t\t\tif (j === 1 && list.length === 2) {\r\n\t\t\t\t\tmessage += ' and ';\r\n\t\t\t\t} else if (j === list.length - 1) {\r\n\t\t\t\t\tmessage += ', and ';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmessage += ', ';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tmessage += BattleLog.escapeHTML(list[j]);\r\n\t\t}\r\n\t\treturn `${message} ${action}`;\r\n\t}\r\n\r\n\toverride destroy() {\r\n\t\tif (this.battle) {\r\n\t\t\t// since battle is defined here, we might as well deallocate it here\r\n\t\t\tthis.battle.destroy();\r\n\t\t} else {\r\n\t\t\tthis.log?.destroy();\r\n\t\t}\r\n\t\tsuper.destroy();\r\n\t}\r\n}\r\n\r\nexport class CopyableURLBox extends preact.Component<{ url: string }> {\r\n\tcopy = () => {\r\n\t\tconst input = this.base!.children[0] as HTMLInputElement;\r\n\t\tinput.select();\r\n\t\tdocument.execCommand('copy');\r\n\t};\r\n\toverride render() {\r\n\t\treturn <div>\r\n\t\t\t<input\r\n\t\t\t\ttype=\"text\" class=\"textbox\" readOnly size={45} value={this.props.url}\r\n\t\t\t\tstyle=\"field-sizing:content\"\r\n\t\t\t/> {}\r\n\t\t\t<button class=\"button\" onClick={this.copy}>Copy</button> {}\r\n\t\t\t<a href={this.props.url} target=\"_blank\" class=\"no-panel-intercept\">\r\n\t\t\t\t<button class=\"button\">Visit</button>\r\n\t\t\t</a>\r\n\t\t</div>;\r\n\t}\r\n}\r\n\r\nexport class ChatTextEntry extends preact.Component<{\r\n\troom: ChatRoom, onMessage: (msg: string, elem: HTMLElement) => void, onKey: (e: KeyboardEvent) => boolean,\r\n\tleft?: number, tinyLayout?: boolean,\r\n}> {\r\n\tsubscription: PSSubscription | null = null;\r\n\ttextbox: HTMLTextAreaElement = null!;\r\n\tminiedit: MiniEdit | null = null;\r\n\thistory: string[] = [];\r\n\thistoryIndex = 0;\r\n\ttabComplete: {\r\n\t\tcandidates: { userid: string, prefixIndex: number }[],\r\n\t\tcandidateIndex: number,\r\n\t\t/** the text left of the cursor before tab completing */\r\n\t\tprefix: string,\r\n\t\t/** the text left of the cursor after tab completing */\r\n\t\tcursor: string,\r\n\t} | null = null;\r\n\toverride componentDidMount() {\r\n\t\tthis.subscription = PS.user.subscribe(() => {\r\n\t\t\tthis.forceUpdate();\r\n\t\t});\r\n\t\tconst textbox = this.base!.children[0].children[1] as HTMLElement;\r\n\t\tif (textbox.tagName === 'TEXTAREA') this.textbox = textbox as HTMLTextAreaElement;\r\n\t\tthis.miniedit = new MiniEdit(textbox, {\r\n\t\t\tsetContent: text => {\r\n\t\t\t\ttextbox.innerHTML = formatText(text, false, false, true) + '\\n';\r\n\t\t\t\ttextbox.classList?.toggle('textbox-empty', !text);\r\n\t\t\t},\r\n\t\t\tonKeyDown: this.onKeyDown,\r\n\t\t});\r\n\t\tif (this.props.room.args?.initialSlash) {\r\n\t\t\tthis.props.room.args.initialSlash = false;\r\n\t\t\tthis.setValue('/', 1);\r\n\t\t}\r\n\t\tif (this.base) this.update();\r\n\t}\r\n\toverride componentWillUnmount() {\r\n\t\tif (this.subscription) {\r\n\t\t\tthis.subscription.unsubscribe();\r\n\t\t\tthis.subscription = null;\r\n\t\t}\r\n\t}\r\n\tupdate = () => {\r\n\t\tif (!this.miniedit) {\r\n\t\t\tconst textbox = this.textbox;\r\n\t\t\ttextbox.style.height = `12px`;\r\n\t\t\tconst newHeight = Math.min(Math.max(textbox.scrollHeight - 2, 16), 600);\r\n\t\t\ttextbox.style.height = `${newHeight}px`;\r\n\t\t}\r\n\t};\r\n\tfocusIfNoSelection = (e: Event) => {\r\n\t\tif ((e.target as HTMLElement).tagName === 'TEXTAREA') return;\r\n\t\tconst selection = window.getSelection()!;\r\n\t\tif (selection.type === 'Range') return;\r\n\t\tconst elem = this.base!.children[0].children[1] as HTMLTextAreaElement;\r\n\t\telem.focus();\r\n\t};\r\n\tsubmit() {\r\n\t\tthis.props.onMessage(this.getValue(), this.miniedit?.element || this.textbox);\r\n\t\tthis.historyPush(this.getValue());\r\n\t\tthis.setValue('', 0);\r\n\t\tthis.update();\r\n\t\treturn true;\r\n\t}\r\n\tonKeyDown = (e: KeyboardEvent) => {\r\n\t\tif (this.handleKey(e) || this.props.onKey(e)) {\r\n\t\t\te.preventDefault();\r\n\t\t\te.stopImmediatePropagation();\r\n\t\t}\r\n\t};\r\n\r\n\t// Direct manipulation functions\r\n\tgetValue() {\r\n\t\treturn this.miniedit ? this.miniedit.getValue() : this.textbox.value;\r\n\t}\r\n\tsetValue(value: string, start: number, end = start) {\r\n\t\tif (this.miniedit) {\r\n\t\t\tthis.miniedit.setValue(value, { start, end });\r\n\t\t} else {\r\n\t\t\tthis.textbox.value = value;\r\n\t\t\tthis.textbox.setSelectionRange?.(start, end);\r\n\t\t}\r\n\t}\r\n\tgetSelection() {\r\n\t\tconst value = this.getValue();\r\n\t\tlet { start, end } = this.miniedit ?\r\n\t\t\t(this.miniedit.getSelection() || { start: value.length, end: value.length }) :\r\n\t\t\t{ start: this.textbox.selectionStart, end: this.textbox.selectionEnd };\r\n\t\treturn { value, start, end };\r\n\t}\r\n\tsetSelection(start: number, end: number) {\r\n\t\tif (this.miniedit) {\r\n\t\t\tthis.miniedit.setSelection({ start, end });\r\n\t\t} else {\r\n\t\t\tthis.textbox.setSelectionRange?.(start, end);\r\n\t\t}\r\n\t}\r\n\treplaceSelection(text: string) {\r\n\t\tif (this.miniedit) {\r\n\t\t\tthis.miniedit.replaceSelection(text);\r\n\t\t} else {\r\n\t\t\tconst { value, start, end } = this.getSelection();\r\n\t\t\tconst newSelection = start + text.length;\r\n\t\t\tthis.setValue(value.slice(0, start) + text + value.slice(end), newSelection);\r\n\t\t}\r\n\t}\r\n\r\n\thistoryUp(ifSelectionCorrect?: boolean) {\r\n\t\tif (ifSelectionCorrect) {\r\n\t\t\tconst { value, start, end } = this.getSelection();\r\n\t\t\tif (start !== end) return false; // never traverse history if text is selected\r\n\t\t\tif (end !== 0) {\r\n\t\t\t\tif (end < value.length) return false; // only go up at start or end of line\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.historyIndex === 0) return false;\r\n\t\tconst line = this.getValue();\r\n\t\tif (line !== '') this.history[this.historyIndex] = line;\r\n\t\tconst newValue = this.history[--this.historyIndex];\r\n\t\tthis.setValue(newValue, newValue.length);\r\n\t\treturn true;\r\n\t}\r\n\thistoryDown(ifSelectionCorrect?: boolean) {\r\n\t\tif (ifSelectionCorrect) {\r\n\t\t\tconst { value, start, end } = this.getSelection();\r\n\t\t\tif (start !== end) return false; // never traverse history if text is selected\r\n\t\t\tif (end < value.length) return false; // only go down at end of line\r\n\t\t}\r\n\r\n\t\tconst line = this.getValue();\r\n\t\tif (line !== '') this.history[this.historyIndex] = line;\r\n\t\tif (this.historyIndex === this.history.length) {\r\n\t\t\tif (!line) return false;\r\n\t\t\tthis.setValue('', 0);\r\n\t\t} else if (++this.historyIndex === this.history.length) {\r\n\t\t\tthis.setValue('', 0);\r\n\t\t} else {\r\n\t\t\tconst newValue = this.history[this.historyIndex];\r\n\t\t\tthis.setValue(newValue, newValue.length);\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\thistoryPush(line: string) {\r\n\t\tconst duplicateIndex = this.history.lastIndexOf(line);\r\n\t\tif (duplicateIndex >= 0) this.history.splice(duplicateIndex, 1);\r\n\t\tif (this.history.length > 100) this.history.splice(0, 20);\r\n\t\tthis.history.push(line);\r\n\t\tthis.historyIndex = this.history.length;\r\n\t}\r\n\thandleKey(ev: KeyboardEvent) {\r\n\t\tconst cmdKey = ((ev.metaKey ? 1 : 0) + (ev.ctrlKey ? 1 : 0) === 1) && !ev.altKey && !ev.shiftKey;\r\n\t\t// const anyModifier = ev.ctrlKey || ev.altKey || ev.metaKey || ev.shiftKey;\r\n\t\tif (ev.keyCode === 13 && !ev.shiftKey) { // Enter key\r\n\t\t\treturn this.submit();\r\n\t\t} else if (ev.keyCode === 13) { // enter\r\n\t\t\tthis.replaceSelection('\\n');\r\n\t\t\treturn true;\r\n\t\t} else if (ev.keyCode === 73 && cmdKey) { // Ctrl + I key\r\n\t\t\treturn this.toggleFormatChar('_');\r\n\t\t} else if (ev.keyCode === 66 && cmdKey) { // Ctrl + B key\r\n\t\t\treturn this.toggleFormatChar('*');\r\n\t\t} else if (ev.keyCode === 192 && cmdKey) { // Ctrl + ` key\r\n\t\t\treturn this.toggleFormatChar('`');\r\n\t\t} else if (ev.keyCode === 9 && !ev.ctrlKey) { // Tab key\r\n\t\t\tconst reverse = !!ev.shiftKey; // Shift+Tab reverses direction\r\n\t\t\treturn this.handleTabComplete(reverse);\r\n\t\t} else if (ev.keyCode === 38 && !ev.shiftKey && !ev.altKey) { // Up key\r\n\t\t\treturn this.historyUp(true);\r\n\t\t} else if (ev.keyCode === 40 && !ev.shiftKey && !ev.altKey) { // Down key\r\n\t\t\treturn this.historyDown(true);\r\n\t\t} else if (ev.keyCode === 27) { // esc\r\n\t\t\tif (this.undoTabComplete()) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif (PS.room !== PS.panel) { // only close if in mini-room mode\r\n\t\t\t\tPS.leave(PS.room.id);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t// } else if (e.keyCode === 32 && PS.user.lastPM && ['/reply', '/r', '/R'].includes(this.getValue())) { // '/reply ' is being written\r\n\t\t// \tconst newValue = `/pm ${PS.user.lastPM}, `;\r\n\t\t// \tthis.setValue(newValue, newValue.length);\r\n\t\t// \treturn true;\r\n\t\t} else if (ev.shiftKey && ev.keyCode === 37) {\r\n\t\t\tif (PS.prefs.onepanel === 'vertical' || this.getValue().length > 0) return;\r\n\t\t\tconst curLoc = PS.room.location;\r\n\t\t\tlet newLoc = curLoc;\r\n\t\t\tlet newIndex: number | null = null;\r\n\t\t\tswitch (curLoc) {\r\n\t\t\tcase 'right': {\r\n\t\t\t\tnewIndex = PS.rightRoomList.indexOf(PS.room.id) - 1;\r\n\t\t\t\tif (newIndex < 0) {\r\n\t\t\t\t\tnewLoc = 'left';\r\n\t\t\t\t\tnewIndex = PS.leftRoomList.length + 1;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcase 'left': {\r\n\t\t\t\tnewIndex = PS.leftRoomList.indexOf(PS.room.id) - 1;\r\n\t\t\t\t// newIndex <= 0 because MainMenu is always at 0 index\r\n\t\t\t\tif (newIndex <= 0) {\r\n\t\t\t\t\tnewLoc = 'mini-window';\r\n\t\t\t\t\tnewIndex = PS.miniRoomList.length + 1;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcase 'mini-window': {\r\n\t\t\t\tnewIndex = PS.miniRoomList.indexOf(PS.room.id) - 1;\r\n\t\t\t\tif (newIndex < 0) {\r\n\t\t\t\t\tnewLoc = 'right';\r\n\t\t\t\t\tnewIndex = PS.rightRoomList.length + 1;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (newIndex !== null) {\r\n\t\t\t\tPS.moveRoom(PS.room, newLoc, false, newIndex);\r\n\t\t\t\tPS.update();\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t} else if (ev.shiftKey && ev.keyCode === 39) {\r\n\t\t\tif (PS.prefs.onepanel === 'vertical' || this.getValue().length > 0) return;\r\n\t\t\tconst curLoc = PS.room.location;\r\n\t\t\tlet newLoc = curLoc;\r\n\t\t\tlet newIndex: number | null = null;\r\n\t\t\tswitch (curLoc) {\r\n\t\t\tcase 'right': {\r\n\t\t\t\tnewIndex = PS.rightRoomList.indexOf(PS.room.id) + 1;\r\n\t\t\t\tif (newIndex >= PS.rightRoomList.length - 1) {\r\n\t\t\t\t\t// newIndex = 1 because NewsPanel is at 0\r\n\t\t\t\t\tnewLoc = 'mini-window';\r\n\t\t\t\t\tnewIndex = 1;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcase 'left': {\r\n\t\t\t\tnewIndex = PS.leftRoomList.indexOf(PS.room.id) + 1;\r\n\t\t\t\tif (newIndex >= PS.leftRoomList.length) {\r\n\t\t\t\t\tnewLoc = 'right';\r\n\t\t\t\t\tnewIndex = 0;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcase 'mini-window': {\r\n\t\t\t\tnewIndex = PS.miniRoomList.indexOf(PS.room.id) + 1;\r\n\t\t\t\tif (newIndex >= PS.miniRoomList.length) {\r\n\t\t\t\t\tnewLoc = 'left';\r\n\t\t\t\t\t// newIndex = 1 because MainMenu is at 0\r\n\t\t\t\t\tnewIndex = 1;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (newIndex !== null) {\r\n\t\t\t\tPS.moveRoom(PS.room, newLoc, false, newIndex);\r\n\t\t\t\tPS.update();\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t} else if (ev.shiftKey && ev.keyCode === 38) {\r\n\t\t\tif (PS.prefs.onepanel !== 'vertical' || this.getValue().length > 0) return;\r\n\t\t\tlet newIndex = PS.rightRoomList.indexOf(PS.room.id) - 1;\r\n\t\t\tif (newIndex < 0) newIndex = PS.rightRoomList.length - 1;\r\n\t\t\tPS.moveRoom(PS.room, 'right', false, newIndex);\r\n\t\t\tPS.update();\r\n\t\t} else if (ev.shiftKey && ev.keyCode === 40) {\r\n\t\t\tif (PS.prefs.onepanel !== 'vertical' || this.getValue().length > 0) return;\r\n\t\t\tlet newIndex = PS.rightRoomList.indexOf(PS.room.id) + 1;\r\n\t\t\tif (newIndex >= PS.rightRoomList.length - 1) newIndex = 0;\r\n\t\t\tPS.moveRoom(PS.room, 'right', false, newIndex);\r\n\t\t\tPS.update();\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t// TODO - add support for commands tabcomplete\r\n\thandleTabComplete(reverse: boolean) {\r\n\t\t// Don't tab complete at the start of the text box.\r\n\t\tlet { value, start, end } = this.getSelection();\r\n\t\tif (start !== end || end === 0) return false;\r\n\r\n\t\tconst users = this.props.room.users;\r\n\t\tlet prefix = value.slice(0, end);\r\n\t\tif (this.tabComplete && prefix === this.tabComplete.cursor) {\r\n\t\t\t// The user is cycling through the candidate names.\r\n\t\t\tif (reverse) {\r\n\t\t\t\tthis.tabComplete.candidateIndex--;\r\n\t\t\t\tif (this.tabComplete.candidateIndex < 0) {\r\n\t\t\t\t\tthis.tabComplete.candidateIndex = this.tabComplete.candidates.length - 1;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.tabComplete.candidateIndex++;\r\n\t\t\t\tif (this.tabComplete.candidateIndex >= this.tabComplete.candidates.length) {\r\n\t\t\t\t\tthis.tabComplete.candidateIndex = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (!value || reverse) {\r\n\t\t\t// not tab completing - let them focus things\r\n\t\t\treturn false;\r\n\t\t} else {\r\n\t\t\t// This is a new tab completion.\r\n\t\t\t// There needs to be non-whitespace to the left of the cursor.\r\n\t\t\t// no command prefixes either, we're testing for usernames here.\r\n\t\t\tprefix = prefix.trim();\r\n\r\n\t\t\t/** match of the closest word left of the cursor */\r\n\t\t\tconst match1 = /^([\\s\\S!/]*?)([A-Za-z0-9][^, \\n]*)$/.exec(prefix);\r\n\t\t\t/** match of the closest two words left of the cursor */\r\n\t\t\tconst match2 = /^([\\s\\S!/]*?)([A-Za-z0-9][^, \\n]* [^, ]*)$/.exec(prefix);\r\n\t\t\tif (!match1 && !match2) return true;\r\n\r\n\t\t\tconst idprefix = (match1 ? toID(match1[2]) : '');\r\n\t\t\tlet spaceprefix = (match2 ? match2[2].replace(/[^A-Za-z0-9 ]+/g, '').toLowerCase() : '');\r\n\t\t\tconst candidates: { userid: string, prefixIndex: number }[] = [];\r\n\t\t\tif (match2 && (match2[0] === '/' || match2[0] === '!')) spaceprefix = '';\r\n\t\t\tfor (const userid in users) {\r\n\t\t\t\tif (spaceprefix && users[userid].slice(1).replace(/[^A-Za-z0-9 ]+/g, '')\r\n\t\t\t\t\t.toLowerCase()\r\n\t\t\t\t\t.startsWith(spaceprefix)) {\r\n\t\t\t\t\tif (match2) candidates.push({ userid, prefixIndex: match2[1].length });\r\n\t\t\t\t} else if (idprefix && userid.startsWith(idprefix)) {\r\n\t\t\t\t\tif (match1) candidates.push({ userid, prefixIndex: match1[1].length });\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// Sort by most recent to speak in the chat, or, in the case of a tie,\r\n\t\t\t// in alphabetical order.\r\n\t\t\tconst userActivity = this.props.room.userActivity;\r\n\t\t\tcandidates.sort((a, b) => {\r\n\t\t\t\tif (a.prefixIndex !== b.prefixIndex) {\r\n\t\t\t\t\t// shorter prefix length comes first\r\n\t\t\t\t\treturn a.prefixIndex - b.prefixIndex;\r\n\t\t\t\t}\r\n\t\t\t\tconst aIndex = userActivity?.indexOf(a.userid as ID) ?? -1;\r\n\t\t\t\tconst bIndex = userActivity?.indexOf(b.userid as ID) ?? -1;\r\n\t\t\t\tif (aIndex !== bIndex) {\r\n\t\t\t\t\treturn bIndex - aIndex; // -1 is fortunately already in the correct order\r\n\t\t\t\t}\r\n\t\t\t\treturn (a.userid < b.userid) ? -1 : 1; // alphabetical order\r\n\t\t\t});\r\n\r\n\t\t\tif (!candidates.length) {\r\n\t\t\t\tthis.tabComplete = null;\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tthis.tabComplete = {\r\n\t\t\t\tcandidates,\r\n\t\t\t\tcandidateIndex: 0,\r\n\t\t\t\tprefix,\r\n\t\t\t\tcursor: prefix,\r\n\t\t\t};\r\n\t\t}\r\n\t\t// Substitute in the tab-completed name\r\n\t\tconst candidate = this.tabComplete.candidates[this.tabComplete.candidateIndex];\r\n\t\tlet name = users[candidate.userid];\r\n\t\tif (!name) return true;\r\n\r\n\t\tname = Dex.getShortName(name.slice(1)); // Remove rank and busy characters\r\n\t\tconst cursor = this.tabComplete.prefix.slice(0, candidate.prefixIndex) + name;\r\n\t\tthis.setValue(cursor + value.slice(end), cursor.length);\r\n\t\tthis.tabComplete.cursor = cursor;\r\n\t\treturn true;\r\n\t}\r\n\tundoTabComplete() {\r\n\t\tif (!this.tabComplete) return false;\r\n\t\tconst value = this.getValue();\r\n\t\tif (!value.startsWith(this.tabComplete.cursor)) return false;\r\n\r\n\t\tthis.setValue(this.tabComplete.prefix + value.slice(this.tabComplete.cursor.length), this.tabComplete.prefix.length);\r\n\t\tthis.tabComplete = null;\r\n\t\treturn true;\r\n\t}\r\n\ttoggleFormatChar(formatChar: string) {\r\n\t\tlet { value, start, end } = this.getSelection();\r\n\r\n\t\t// make sure start and end aren't midway through the syntax\r\n\t\tif (value.charAt(start) === formatChar && value.charAt(start - 1) === formatChar &&\r\n\t\t\tvalue.charAt(start - 2) !== formatChar) {\r\n\t\t\tstart++;\r\n\t\t}\r\n\t\tif (value.charAt(end) === formatChar && value.charAt(end - 1) === formatChar &&\r\n\t\t\tvalue.charAt(end - 2) !== formatChar) {\r\n\t\t\tend--;\r\n\t\t}\r\n\r\n\t\t// wrap in doubled format char\r\n\t\tconst wrap = formatChar + formatChar;\r\n\t\tvalue = value.slice(0, start) + wrap + value.slice(start, end) + wrap + value.slice(end);\r\n\t\tstart += 2;\r\n\t\tend += 2;\r\n\r\n\t\t// prevent nesting\r\n\t\tconst nesting = wrap + wrap;\r\n\t\tif (value.slice(start - 4, start) === nesting) {\r\n\t\t\tvalue = value.slice(0, start - 4) + value.slice(start);\r\n\t\t\tstart -= 4;\r\n\t\t\tend -= 4;\r\n\t\t} else if (start !== end && value.slice(start - 2, start + 2) === nesting) {\r\n\t\t\tvalue = value.slice(0, start - 2) + value.slice(start + 2);\r\n\t\t\tstart -= 2;\r\n\t\t\tend -= 4;\r\n\t\t}\r\n\t\tif (value.slice(end, end + 4) === nesting) {\r\n\t\t\tvalue = value.slice(0, end) + value.slice(end + 4);\r\n\t\t} else if (start !== end && value.slice(end - 2, end + 2) === nesting) {\r\n\t\t\tvalue = value.slice(0, end - 2) + value.slice(end + 2);\r\n\t\t\tend -= 2;\r\n\t\t}\r\n\r\n\t\tthis.setValue(value, start, end);\r\n\t\treturn true;\r\n\t}\r\n\toverride render() {\r\n\t\tconst { room } = this.props;\r\n\t\tconst OLD_TEXTBOX = false;\r\n\t\tif (room.connected === 'client-only' && room.id.startsWith('battle-')) {\r\n\t\t\treturn <div\r\n\t\t\t\tclass=\"chat-log-add hasuserlist\" onClick={this.focusIfNoSelection} style={{ left: this.props.left || 0 }}\r\n\t\t\t><CopyableURLBox url={`https://psim.us/r/${room.id.slice(7)}`} /></div>;\r\n\t\t}\r\n\r\n\t\tconst canTalk = PS.user.named || room.id === 'dm-';\r\n\t\tconst connected = room.connected === true || room.connected === 'client-only';\r\n\t\treturn <div\r\n\t\t\tclass=\"chat-log-add hasuserlist\" onClick={this.focusIfNoSelection} style={{ left: this.props.left || 0 }}\r\n\t\t>\r\n\t\t\t<form class={`chatbox${this.props.tinyLayout ? ' nolabel' : ''}`} style={canTalk ? {} : { display: 'none' }}>\r\n\t\t\t\t<label style={`color:${BattleLog.usernameColor(PS.user.userid)}`}>{PS.user.name}:</label>\r\n\t\t\t\t{OLD_TEXTBOX ? <textarea\r\n\t\t\t\t\tclass={connected && canTalk ? 'textbox autofocus' : 'textbox disabled'}\r\n\t\t\t\t\tautofocus\r\n\t\t\t\t\trows={1}\r\n\t\t\t\t\tonInput={this.update}\r\n\t\t\t\t\tonKeyDown={this.onKeyDown}\r\n\t\t\t\t\tstyle={{ resize: 'none', width: '100%', height: '16px', padding: '2px 3px 1px 3px' }}\r\n\t\t\t\t\tplaceholder={PSView.focusPreview(room)}\r\n\t\t\t\t/> : <ChatTextBox\r\n\t\t\t\t\tdisabled={!connected || !canTalk}\r\n\t\t\t\t\tplaceholder={PSView.focusPreview(room)}\r\n\t\t\t\t/>}\r\n\t\t\t</form>\r\n\t\t\t{!canTalk && <button data-href=\"login\" class=\"button autofocus\">\r\n\t\t\t\tChoose a name before sending messages\r\n\t\t\t</button>}\r\n\t\t</div>;\r\n\t}\r\n}\r\n\r\nclass ChatTextBox extends preact.Component<{ placeholder: string, disabled?: boolean }> {\r\n\toverride shouldComponentUpdate(nextProps: any) {\r\n\t\tthis.base!.setAttribute(\"placeholder\", nextProps.placeholder);\r\n\t\tthis.base!.classList?.toggle('disabled', !!nextProps.disabled);\r\n\t\tthis.base!.classList?.toggle('autofocus', !nextProps.disabled);\r\n\t\treturn false;\r\n\t}\r\n\thandleFocus = () => {\r\n\t\tPSView.setTextboxFocused(true);\r\n\t};\r\n\thandleBlur = () => {\r\n\t\tPSView.setTextboxFocused(false);\r\n\t};\r\n\toverride render() {\r\n\t\treturn <pre\r\n\t\t\tclass={`textbox textbox-empty ${this.props.disabled ? ' disabled' : ' autofocus'}`} placeholder={this.props.placeholder}\r\n\t\t\tonFocus={this.handleFocus} onBlur={this.handleBlur}\r\n\t\t>{'\\n'}</pre>;\r\n\t}\r\n}\r\n\r\nclass ChatPanel extends PSRoomPanel<ChatRoom> {\r\n\tstatic readonly id = 'chat';\r\n\tstatic readonly routes = ['dm-*', 'groupchat-*', '*'];\r\n\tstatic readonly Model = ChatRoom;\r\n\tstatic readonly location = 'right';\r\n\tstatic readonly icon = <i class=\"fa fa-comment-o\" aria-hidden></i>;\r\n\toverride componentDidMount(): void {\r\n\t\tsuper.componentDidMount();\r\n\t\tthis.subscribeTo(PS.user, () => {\r\n\t\t\tthis.props.room.updateTarget();\r\n\t\t});\r\n\t}\r\n\tsend = (text: string, elem: HTMLElement) => {\r\n\t\tthis.props.room.send(text, elem);\r\n\t};\r\n\tonKey = (e: KeyboardEvent) => {\r\n\t\tif (e.keyCode === 33) { // Pg Up key\r\n\t\t\tconst chatLog = this.base!.getElementsByClassName('chat-log')[0] as HTMLDivElement;\r\n\t\t\tchatLog.scrollTop = chatLog.scrollTop - chatLog.offsetHeight + 60;\r\n\t\t\treturn true;\r\n\t\t} else if (e.keyCode === 34) { // Pg Dn key\r\n\t\t\tconst chatLog = this.base!.getElementsByClassName('chat-log')[0] as HTMLDivElement;\r\n\t\t\tchatLog.scrollTop = chatLog.scrollTop + chatLog.offsetHeight - 60;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t};\r\n\tmakeChallenge = (e: Event, format: string, team?: Team) => {\r\n\t\tconst elem = e.target as HTMLElement;\r\n\t\tconst now = Date.now();\r\n\t\tconst lastChallenged = PS.mainmenu.lastChallenged || 0;\r\n\t\tif (now - lastChallenged < 5_000) {\r\n\t\t\tPS.alert(`Please wait 5 seconds before challenging again.`, {\r\n\t\t\t\tparentElem: elem,\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tPS.requestNotifications();\r\n\t\tconst room = this.props.room;\r\n\t\tconst packedTeam = team ? team.packedTeam : '';\r\n\t\tconst privacy = PS.mainmenu.adjustPrivacy();\r\n\t\tif (!room.pmTarget) throw new Error(\"Not a PM room\");\r\n\t\tPS.send(`/utm ${packedTeam}`);\r\n\t\tPS.send(`${privacy}/challenge ${room.pmTarget}, ${format}`);\r\n\t\troom.teamSent = format || '-';\r\n\t\troom.update(null);\r\n\t};\r\n\tacceptChallenge = (e: Event, format: string, team?: Team) => {\r\n\t\tconst room = this.props.room;\r\n\t\tconst packedTeam = team ? team.packedTeam : '';\r\n\t\tif (!room.pmTarget) throw new Error(\"Not a PM room\");\r\n\t\tPS.send(`/utm ${packedTeam}`);\r\n\t\tthis.props.room.send(`/accept`);\r\n\t\troom.teamSent = format || '-';\r\n\t\troom.update(null);\r\n\t};\r\n\r\n\toverride render() {\r\n\t\tconst room = this.props.room;\r\n\t\tconst tinyLayout = room.width < 450;\r\n\r\n\t\tconst defaultFormat = room.args?.format as string | undefined;\r\n\t\tif (defaultFormat?.startsWith('!!')) {\r\n\t\t\troom.args!.format = undefined;\r\n\t\t}\r\n\r\n\t\tconst challengeSent = room.teamSent && !room.challenged;\r\n\t\tconst challengeTo = room.challenging ? <div class=\"challenge outgoing\">\r\n\t\t\t<p>Waiting for {room.pmTarget}...</p>\r\n\t\t\t<TeamForm format={room.challenging.formatName} teamFormat={room.challenging.teamFormat} onSubmit={null}>\r\n\t\t\t\t<button data-cmd=\"/cancelchallenge\" class=\"button\">Cancel</button>\r\n\t\t\t</TeamForm>\r\n\t\t</div> : room.challengeMenuOpen ? <div class=\"challenge outgoing\">\r\n\t\t\t<TeamForm onSubmit={this.makeChallenge} defaultFormat={defaultFormat}>\r\n\t\t\t\t{challengeSent && <button class=\"button\" disabled>\r\n\t\t\t\t\tChallenging...\r\n\t\t\t\t</button>}\r\n\t\t\t\t{!challengeSent && <button type=\"submit\" class=\"button button-first\" disabled={!!room.challenged}>\r\n\t\t\t\t\t<strong>Challenge</strong>\r\n\t\t\t\t</button>}\r\n\t\t\t\t{!challengeSent && <button data-href=\"battleoptions\" class=\"button button-last\" aria-label=\"Battle options\">\r\n\t\t\t\t\t<i class=\"fa fa-caret-down\" aria-hidden></i>\r\n\t\t\t\t</button>} {}\r\n\t\t\t\t<button data-cmd=\"/cancelchallenge\" class=\"button\">Cancel</button>\r\n\t\t\t</TeamForm>\r\n\t\t</div> : null;\r\n\r\n\t\tconst challengeFrom = room.challenged ? <div class=\"challenge\">\r\n\t\t\t{!!room.challenged.message && <p>{room.challenged.message}</p>}\r\n\t\t\t<TeamForm format={room.challenged.formatName} teamFormat={room.challenged.teamFormat} onSubmit={this.acceptChallenge}>\r\n\t\t\t\t{room.teamSent && <button class=\"button\" disabled>\r\n\t\t\t\t\tAccepting...\r\n\t\t\t\t</button>}\r\n\t\t\t\t{!room.teamSent && <button type=\"submit\" class={room.challenged.formatName ? `button button-first` : `button`}>\r\n\t\t\t\t\t<strong>{room.challenged.acceptButtonLabel || 'Accept'}</strong>\r\n\t\t\t\t</button>}\r\n\t\t\t\t{!room.teamSent && room.challenged.formatName && <button\r\n\t\t\t\t\tdata-href=\"battleoptions\" class=\"button button-last\" aria-label=\"Battle options\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<i class=\"fa fa-caret-down\" aria-hidden></i>\r\n\t\t\t\t</button>} {}\r\n\t\t\t\t<button data-cmd=\"/reject\" class=\"button\">{room.challenged.rejectButtonLabel || 'Reject'}</button>\r\n\t\t\t</TeamForm>\r\n\t\t</div> : null;\r\n\r\n\t\treturn <PSPanelWrapper room={room} focusClick fullSize>\r\n\t\t\t<ChatLog\r\n\t\t\t\tclass={`chat-log${tinyLayout ? '' : ' hasuserlist'}`} room={this.props.room}\r\n\t\t\t\tleft={tinyLayout ? 0 : 146} top={room.tour?.info.isActive ? 30 : 0}\r\n\t\t\t>\r\n\t\t\t\t{challengeTo}{challengeFrom}{PS.isOffline && <p class=\"buttonbar\">\r\n\t\t\t\t\t<button class=\"button\" data-cmd=\"/reconnect\">\r\n\t\t\t\t\t\t<i class=\"fa fa-plug\" aria-hidden></i> <strong>Reconnect</strong>\r\n\t\t\t\t\t</button> {}\r\n\t\t\t\t\t{PS.connection?.reconnectTimer && <small>(Autoreconnect in {Math.round(PS.connection.reconnectDelay / 1000)}s)</small>}\r\n\t\t\t\t</p>}\r\n\t\t\t</ChatLog>\r\n\t\t\t{room.tour && <TournamentBox tour={room.tour} left={tinyLayout ? 0 : 146} />}\r\n\t\t\t<ChatTextEntry\r\n\t\t\t\troom={this.props.room} onMessage={this.send} onKey={this.onKey} left={tinyLayout ? 0 : 146} tinyLayout={tinyLayout}\r\n\t\t\t/>\r\n\t\t\t<ChatUserList room={this.props.room} minimized={tinyLayout} />\r\n\t\t</PSPanelWrapper>;\r\n\t}\r\n}\r\n\r\nexport class ChatUserList extends preact.Component<{\r\n\troom: ChatRoom, left?: number, top?: number, minimized?: boolean, static?: boolean,\r\n}> {\r\n\trender() {\r\n\t\tconst room = this.props.room;\r\n\t\tconst pmTargetid = room.pmTarget ? toID(room.pmTarget) : null;\r\n\t\treturn <div\r\n\t\t\tclass={'userlist' + (this.props.minimized ? ' userlist-hidden' : this.props.static ? ' userlist-static' : '')}\r\n\t\t\tstyle={{ left: this.props.left || 0, top: this.props.top || 0 }}\r\n\t\t>\r\n\t\t\t{!this.props.minimized ? (\r\n\t\t\t\t<div class=\"userlist-count\"><small>{room.userCount} users</small></div>\r\n\t\t\t) : room.id === 'dm-' ? (\r\n\t\t\t\t<>\r\n\t\t\t\t\t<button class=\"button button-middle\" data-cmd=\"/help\">Commands</button>\r\n\t\t\t\t</>\r\n\t\t\t) : pmTargetid ? (\r\n\t\t\t\t<>\r\n\t\t\t\t\t<button class=\"button button-middle\" data-cmd=\"/challenge\">Challenge</button>\r\n\t\t\t\t\t<button class=\"button button-middle\" data-href={`useroptions-${pmTargetid}`}>{'\\u2026'}</button>\r\n\t\t\t\t</>\r\n\t\t\t) : (\r\n\t\t\t\t<button data-href=\"userlist\" class=\"button button-middle\">{room.userCount} users</button>\r\n\t\t\t)}\r\n\t\t\t<ul>\r\n\t\t\t\t{room.onlineUsers.map(([userid, name]) => {\r\n\t\t\t\t\tconst groupSymbol = name.charAt(0);\r\n\t\t\t\t\tconst group = PS.server.groups[groupSymbol] || { type: 'user', order: 0 };\r\n\t\t\t\t\tlet color;\r\n\t\t\t\t\tif (name.endsWith('@!')) {\r\n\t\t\t\t\t\tname = name.slice(0, -2);\r\n\t\t\t\t\t\tcolor = '#888888';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcolor = BattleLog.usernameColor(userid);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn <li key={userid}><button class=\"userbutton username\">\r\n\t\t\t\t\t\t<em class={`group${['leadership', 'staff'].includes(group.type!) ? ' staffgroup' : ''}`}>\r\n\t\t\t\t\t\t\t{groupSymbol}\r\n\t\t\t\t\t\t</em>\r\n\t\t\t\t\t\t{group.type === 'leadership' ? (\r\n\t\t\t\t\t\t\t<strong><em style={`color:${color}`}>{name.slice(1)}</em></strong>\r\n\t\t\t\t\t\t) : group.type === 'staff' ? (\r\n\t\t\t\t\t\t\t<strong style={`color:${color} `}>{name.slice(1)}</strong>\r\n\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t<span style={`color:${color}`}>{name.slice(1)}</span>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</button></li>;\r\n\t\t\t\t})}\r\n\t\t\t</ul>\r\n\t\t</div>;\r\n\t}\r\n}\r\n\r\nexport class ChatLog extends preact.Component<{\r\n\tclass: string, room: ChatRoom, children?: preact.ComponentChildren,\r\n\tleft?: number, top?: number, noSubscription?: boolean,\r\n}> {\r\n\tsubscription: PSSubscription | null = null;\r\n\toverride componentDidMount() {\r\n\t\tconst room = this.props.room;\r\n\t\tif (room.log) {\r\n\t\t\tconst elem = room.log.elem;\r\n\t\t\tthis.base!.replaceChild(elem, this.base!.firstChild!);\r\n\t\t\telem.className = this.props.class;\r\n\t\t\telem.style.left = `${this.props.left || 0}px`;\r\n\t\t\telem.style.top = `${this.props.top || 0}px`;\r\n\t\t}\r\n\t\tif (!this.props.noSubscription) {\r\n\t\t\troom.log ||= new BattleLog(this.base!.firstChild as HTMLDivElement);\r\n\t\t\troom.log.getHighlight = room.handleHighlight;\r\n\t\t\tif (room.backlog) {\r\n\t\t\t\tconst backlog = room.backlog;\r\n\t\t\t\troom.backlog = null;\r\n\t\t\t\tfor (const args of backlog) {\r\n\t\t\t\t\troom.log.add(args, undefined, undefined, PS.prefs.timestamps[room.pmTarget ? 'pms' : 'chatrooms']);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.subscription = room.subscribe(tokens => {\r\n\t\t\t\tif (!tokens) return;\r\n\t\t\t\tthis.props.room.log!.add(tokens, undefined, undefined, PS.prefs.timestamps[room.pmTarget ? 'pms' : 'chatrooms']);\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis.setControlsJSX(this.props.children);\r\n\t}\r\n\toverride componentWillUnmount() {\r\n\t\tthis.subscription?.unsubscribe();\r\n\t}\r\n\toverride shouldComponentUpdate(props: typeof ChatLog.prototype.props) {\r\n\t\tconst elem = this.base!.firstChild as HTMLDivElement;\r\n\t\tif (props.class !== this.props.class) {\r\n\t\t\telem.className = props.class;\r\n\t\t}\r\n\t\tif (props.left !== this.props.left) elem.style.left = `${props.left || 0}px`;\r\n\t\tif (props.top !== this.props.top) elem.style.top = `${props.top || 0}px`;\r\n\t\tthis.setControlsJSX(props.children);\r\n\t\tthis.updateScroll();\r\n\t\treturn false;\r\n\t}\r\n\tsetControlsJSX(jsx: preact.ComponentChildren | undefined) {\r\n\t\tconst elem = this.base!.firstChild as HTMLDivElement;\r\n\t\tconst children = elem.children;\r\n\t\tlet controlsElem = children[children.length - 1] as HTMLDivElement | undefined;\r\n\t\tif (controlsElem && controlsElem.className !== 'controls') controlsElem = undefined;\r\n\t\tif (!jsx) {\r\n\t\t\tif (!controlsElem) return;\r\n\t\t\telem.removeChild(controlsElem);\r\n\t\t\tthis.updateScroll();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!controlsElem) {\r\n\t\t\tcontrolsElem = document.createElement('div');\r\n\t\t\tcontrolsElem.className = 'controls';\r\n\t\t\telem.appendChild(controlsElem);\r\n\t\t}\r\n\t\t// for some reason, the replaceNode feature isn't working?\r\n\t\tif (controlsElem.children[0]) controlsElem.removeChild(controlsElem.children[0]);\r\n\t\tpreact.render(<div>{jsx}</div>, controlsElem);\r\n\t\tthis.updateScroll();\r\n\t}\r\n\tupdateScroll() {\r\n\t\tthis.props.room.log?.updateScroll();\r\n\t}\r\n\trender() {\r\n\t\treturn <div><div\r\n\t\t\tclass={this.props.class} role=\"log\" aria-label=\"Chat log\"\r\n\t\t\tstyle={{ left: this.props.left || 0, top: this.props.top || 0 }}\r\n\t\t></div></div>;\r\n\t}\r\n}\r\n\r\nPS.addRoomType(ChatPanel);\r\n"],"mappings":"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","ignoreList":[]}