{"version":3,"file":"panel-mainmenu.js","names":["MainMenuRoom","_PSRoom","options","_this","call","classType","listeners","userdetailsCache","roomsCache","searchCountdown","teamSent","search","searching","games","disallowSpectators","PS","prefs","disallowspectators","lastChallenged","startSearch","format","team","parentElem","requestNotifications","alert","includes","BattleLog","formatName","packedTeam","countdown","timer","setInterval","doSearchCountdown","update","cancelSearch","_this$search$searchin","clearTimeout","length","send","doSearch","privacy","adjustPrivacy","backlog","rooms","mainmenu","_i2","_this$backlog2","args","receiveLine","_inheritsLoose","_proto","prototype","set","searchingFormat","_this$searchCountdown","_this$search$searchin2","cmd","challstr","user","PSLoginServer","query","then","res","username","initializing","replace","loggedin","registered","name","userid","toID","handleAssertion","assertion","fullName","namedCode","avatar","named","setName","teams","loadRemoteTeams","challengesBuf","receiveChallenges","searchBuf","receiveSearch","queryId","responseJSON","handleQueryResponse","JSON","parse","_sideRoom$log","user1","user2","message","handlePM","sideRoom","rightPanel","type","inchatpm","log","add","parseFormats","roomid","room","lobby","dataBuf","json","_unused","challengesFrom","getPMRoom","challengeTo","to","_json$challengeTo","_json$challengeTo2","pmTarget","targetUserid","challenged","challenging","parseChallenge","_unused2","formatsList","isSection","section","column","window","NonBattleGames","rps","i","BattleFormats","j","entry","usesLocalLadder","startsWith","isNaN","Number","slice","parseInt","_BattleFormats$id","searchShow","challengeShow","tournamentShow","teambuilderLevel","lastCommaIndex","lastIndexOf","code","substr","NaN","id","isTeambuilderFormat","endsWith","teambuilderFormat","teambuilderFormatName","parenPos","indexOf","trim","rated","effectType","multivariantFormats","battleFormat","userid1","userid2","pmTargetid","addRoom","autofocus","updateTarget","makeQuery","param","_this2","fullid","Promise","resolve","push","response","_PS$rooms","_PS$rooms2","_PS$rooms3","userdetails","Object","assign","pspl","_i4","_response$pspl2","roomInfo","spotlight","chat","concat","official","_i6","_response$official2","roomsRoom","battlesRoom","battleTable","battles","battleid","_i8","_Object$entries2","entries","_ref","ladderRoom","uploading","_PS$rooms4","_PS$rooms$teambuilder","uploaded","teamid","notLoaded","key","teambuilder","_i10","_PS$teams$list2","list","_PS$rooms5","_PS$rooms$teambuilder2","_i12","_ref3","callback","PSRoom","NewsPanel","_PSRoomPanel","_this3","_len","arguments","Array","_key","apply","change","ev","target","currentTarget","value","document","cookie","location","href","_proto2","render","cookieSet","preact","h","PSPanelWrapper","props","fullSize","scrollable","onChange","checked","style","dangerouslySetInnerHTML","__html","newsHTML","PSRoomPanel","routes","title","MainMenuPanel","_PSRoomPanel2","_this4","_len2","_key2","submitSearch","join","base","querySelector","handleDragStart","e","_PS$rightPanel","getRoom","foreground","leftPanel","dragging","handleDragEnter","_PS$dragging","_PS$rooms$draggingRoo","preventDefault","draggingRoom","draggedOverRoom","index","miniRoomList","dragOnto","handleClickMinimize","_e$target","_e$target2","getAttribute","parentNode","minimized","forceUpdate","_proto3","focus","_this$base","renderMiniRoom","RoomType","roomTypes","Panel","renderMiniRooms","_this5","map","notifying","notifications","isSubtleNotifying","draggable","onDragStart","onClick","tabIndex","renderGames","_ref4","gameName","renderSearchButton","down","textAlign","width","height","src","Config","client","alt","isOffline","_PS$connection","TeamForm","onSubmit","selectType","disabled","connection","reconnectTimer","Math","round","reconnectDelay","undefined","Fragment","onlineButton","tinyLayout","onDragEnter","display","leftPanelWidth","server","dex","replays","root","Model","icon","FormatDropdown","_preact$Component","_this6","_len3","_key3","_proto4","defaultFormat","_this$format$split","split","customRules","placeholder","Component","TeamDropdown","_preact$Component2","_this7","_len4","_key4","teamFormat","teamKey","_proto5","getDefaultTeam","_i14","_PS$teams$list4","_window$BattleFormats","formatData","PSIcon","pokemon","byKey","TeamBox","noLink","_preact$Component3","_this8","_len5","_key5","changeFormat","submit","validate","_window$BattleFormats2","teamElement","loadTeam","_ref5","onValidate","handleClick","tagName","_proto6","_this$props$defaultFo","Dex","gen","starredPrefs","starredformats","starred","keys","filter","reverse","_i16","hideFormat","children","addRoomType"],"sources":["../src/panel-mainmenu.tsx"],"sourcesContent":["/**\r\n * Main menu panel\r\n *\r\n * @author Guangcong Luo <guangcongluo@gmail.com>\r\n * @license AGPLv3\r\n */\r\n\r\nimport preact from \"../js/lib/preact\";\r\nimport { PSLoginServer } from \"./client-connection\";\r\nimport { Config, PS, PSRoom, type RoomID, type RoomOptions, type Team } from \"./client-main\";\r\nimport { PSIcon, PSPanelWrapper, PSRoomPanel } from \"./panels\";\r\nimport type { BattlesRoom } from \"./panel-battle\";\r\nimport type { ChatRoom } from \"./panel-chat\";\r\nimport type { LadderFormatRoom } from \"./panel-ladder\";\r\nimport type { RoomsRoom } from \"./panel-rooms\";\r\nimport { TeamBox, type SelectType } from \"./panel-teamdropdown\";\r\nimport { Dex, toID, type ID } from \"./battle-dex\";\r\nimport type { Args } from \"./battle-text-parser\";\r\nimport { BattleLog } from \"./battle-log\"; // optional\r\n\r\nexport type RoomInfo = {\r\n\ttitle: string, desc?: string, userCount?: number, section?: string, privacy?: 'hidden',\r\n\tspotlight?: string, subRooms?: string[],\r\n};\r\n\r\nexport class MainMenuRoom extends PSRoom {\r\n\toverride readonly classType: string = 'mainmenu';\r\n\tlisteners: Record<string, ((response: any) => void)[] | null> = {};\r\n\tuserdetailsCache: {\r\n\t\t[userid: string]: {\r\n\t\t\tuserid: ID,\r\n\t\t\tname: string,\r\n\t\t\tavatar?: string | number,\r\n\t\t\tstatus?: string,\r\n\t\t\tgroup?: string,\r\n\t\t\tcustomgroup?: string,\r\n\t\t\trooms?: { [roomid: string]: { isPrivate?: true, p1?: string, p2?: string } },\r\n\t\t},\r\n\t} = {};\r\n\troomsCache: {\r\n\t\tbattleCount?: number,\r\n\t\tuserCount?: number,\r\n\t\tchat?: RoomInfo[],\r\n\t\tsectionTitles?: string[],\r\n\t} = {};\r\n\tsearchCountdown: { format: string, packedTeam: string, countdown: number, timer: number } | null = null;\r\n\t/** used to track the moment between \"search sent\" and \"server acknowledged search sent\" */\r\n\tteamSent: string | null = null;\r\n\tsearch: { searching: string[], games: Record<RoomID, string> | null } = { searching: [], games: null };\r\n\tdisallowSpectators: boolean | null = PS.prefs.disallowspectators;\r\n\tlastChallenged: number | null = null;\r\n\tconstructor(options: RoomOptions) {\r\n\t\tsuper(options);\r\n\t\tif (this.backlog) {\r\n\t\t\t// these aren't set yet, but a lot of things could go wrong if we don't\r\n\t\t\tPS.rooms[''] = this;\r\n\t\t\tPS.mainmenu = this;\r\n\t\t\tfor (const args of this.backlog) {\r\n\t\t\t\tthis.receiveLine(args);\r\n\t\t\t}\r\n\t\t\tthis.backlog = null;\r\n\t\t}\r\n\t}\r\n\tadjustPrivacy() {\r\n\t\tPS.prefs.set('disallowspectators', this.disallowSpectators);\r\n\t\tif (this.disallowSpectators) return '/noreply /hidenext \\n';\r\n\t\treturn '';\r\n\t}\r\n\tstartSearch = (format: string, team?: Team, parentElem?: HTMLElement | null) => {\r\n\t\tPS.requestNotifications();\r\n\t\tif (this.searchCountdown) {\r\n\t\t\tPS.alert(\"Wait for this countdown to finish first...\", { parentElem });\r\n\t\t\treturn;\r\n\t\t} else if (this.search.searching.includes(format)) {\r\n\t\t\tPS.alert(`You're already searching for a ${BattleLog.formatName(format)} battle...`, { parentElem });\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.searchCountdown = {\r\n\t\t\tformat,\r\n\t\t\tpackedTeam: team?.packedTeam || '',\r\n\t\t\tcountdown: 3,\r\n\t\t\ttimer: setInterval(this.doSearchCountdown, 1000),\r\n\t\t};\r\n\t\tthis.update(null);\r\n\t};\r\n\tsearchingFormat() {\r\n\t\treturn this.searchCountdown?.format || this.teamSent ||\r\n\t\t\tthis.search.searching?.[this.search.searching.length - 1] || null;\r\n\t}\r\n\tcancelSearch = () => {\r\n\t\tif (this.searchCountdown) {\r\n\t\t\tclearTimeout(this.searchCountdown.timer);\r\n\t\t\tthis.searchCountdown = null;\r\n\t\t\tthis.update(null);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tif (this.teamSent || this.search.searching?.length) {\r\n\t\t\tthis.teamSent = null;\r\n\t\t\tPS.send(`/cancelsearch`);\r\n\t\t\tthis.update(null);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t};\r\n\tdoSearchCountdown = () => {\r\n\t\tif (!this.searchCountdown) return; // ??? race???\r\n\r\n\t\tthis.searchCountdown.countdown--;\r\n\t\tif (this.searchCountdown.countdown <= 0) {\r\n\t\t\tthis.doSearch(this.searchCountdown);\r\n\t\t\tclearTimeout(this.searchCountdown.timer);\r\n\t\t\tthis.searchCountdown = null;\r\n\t\t}\r\n\t\tthis.update(null);\r\n\t};\r\n\tdoSearch = (search: NonNullable<typeof this.searchCountdown>) => {\r\n\t\tthis.teamSent = search.format;\r\n\t\tconst privacy = this.adjustPrivacy();\r\n\t\tPS.send(`/utm ${search.packedTeam}`);\r\n\t\tPS.send(`${privacy}/search ${search.format}`);\r\n\t};\r\n\toverride receiveLine(args: Args) {\r\n\t\tconst [cmd] = args;\r\n\t\tswitch (cmd) {\r\n\t\tcase 'challstr': {\r\n\t\t\tconst [, challstr] = args;\r\n\t\t\tPS.user.challstr = challstr;\r\n\t\t\tPSLoginServer.query(\r\n\t\t\t\t'upkeep', { challstr }\r\n\t\t\t).then(res => {\r\n\t\t\t\tif (!res?.username) {\r\n\t\t\t\t\tPS.user.initializing = false;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// | , ; are not valid characters in names\r\n\t\t\t\tres.username = res.username.replace(/[|,;]+/g, '');\r\n\t\t\t\tif (res.loggedin) {\r\n\t\t\t\t\tPS.user.registered = { name: res.username, userid: toID(res.username) };\r\n\t\t\t\t}\r\n\t\t\t\tPS.user.handleAssertion(res.username, res.assertion);\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t} case 'updateuser': {\r\n\t\t\tconst [, fullName, namedCode, avatar] = args;\r\n\t\t\tconst named = namedCode === '1';\r\n\t\t\tif (named) PS.user.initializing = false;\r\n\t\t\tPS.user.setName(fullName, named, avatar);\r\n\t\t\tPS.teams.loadRemoteTeams();\r\n\t\t\treturn;\r\n\t\t} case 'updatechallenges': {\r\n\t\t\tconst [, challengesBuf] = args;\r\n\t\t\tthis.receiveChallenges(challengesBuf);\r\n\t\t\treturn;\r\n\t\t} case 'updatesearch': {\r\n\t\t\tconst [, searchBuf] = args;\r\n\t\t\tthis.receiveSearch(searchBuf);\r\n\t\t\treturn;\r\n\t\t} case 'queryresponse': {\r\n\t\t\tconst [, queryId, responseJSON] = args;\r\n\t\t\tthis.handleQueryResponse(queryId as ID, JSON.parse(responseJSON));\r\n\t\t\treturn;\r\n\t\t} case 'pm': {\r\n\t\t\tconst [, user1, user2, message] = args;\r\n\t\t\tthis.handlePM(user1, user2, message);\r\n\t\t\tlet sideRoom = PS.rightPanel as ChatRoom;\r\n\t\t\tif (sideRoom?.type === \"chat\" && PS.prefs.inchatpm) sideRoom?.log?.add(args);\r\n\t\t\treturn;\r\n\t\t} case 'formats': {\r\n\t\t\tthis.parseFormats(args);\r\n\t\t\treturn;\r\n\t\t} case 'popup': {\r\n\t\t\tconst [, message] = args;\r\n\t\t\tfor (const roomid in PS.rooms) {\r\n\t\t\t\tconst room = PS.rooms[roomid] as ChatRoom | MainMenuRoom;\r\n\t\t\t\tif (room.teamSent) {\r\n\t\t\t\t\troom.teamSent = null;\r\n\t\t\t\t\troom.update(null);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tPS.alert(message.replace(/\\|\\|/g, '\\n'));\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t}\r\n\t\tconst lobby = PS.rooms['lobby'];\r\n\t\tif (lobby) lobby.receiveLine(args);\r\n\t}\r\n\treceiveChallenges(dataBuf: string) {\r\n\t\tlet json;\r\n\t\ttry {\r\n\t\t\tjson = JSON.parse(dataBuf);\r\n\t\t} catch {}\r\n\t\tfor (const userid in json.challengesFrom) {\r\n\t\t\tPS.getPMRoom(toID(userid));\r\n\t\t}\r\n\t\tif (json.challengeTo) {\r\n\t\t\tPS.getPMRoom(toID(json.challengeTo.to));\r\n\t\t}\r\n\t\tfor (const roomid in PS.rooms) {\r\n\t\t\tconst room = PS.rooms[roomid] as ChatRoom;\r\n\t\t\tif (!room.pmTarget) continue;\r\n\t\t\tconst targetUserid = toID(room.pmTarget);\r\n\t\t\tif (!room.challenged && !(targetUserid in json.challengesFrom) &&\r\n\t\t\t\t!room.challenging && json.challengeTo?.to !== targetUserid) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\troom.challenged = room.parseChallenge(json.challengesFrom[targetUserid]);\r\n\t\t\troom.challenging = json.challengeTo?.to === targetUserid ? room.parseChallenge(json.challengeTo.format) : null;\r\n\t\t\troom.update(null);\r\n\t\t}\r\n\t}\r\n\treceiveSearch(dataBuf: string) {\r\n\t\tlet json;\r\n\t\tthis.teamSent = null;\r\n\t\ttry {\r\n\t\t\tjson = JSON.parse(dataBuf);\r\n\t\t} catch {}\r\n\t\tthis.search = json;\r\n\t\tthis.update(null);\r\n\t}\r\n\tparseFormats(formatsList: string[]) {\r\n\t\tlet isSection = false;\r\n\t\tlet section = '';\r\n\r\n\t\tlet column = 0;\r\n\r\n\t\twindow.NonBattleGames = { rps: 'Rock Paper Scissors' };\r\n\t\tfor (let i = 3; i <= 9; i += 2) {\r\n\t\t\twindow.NonBattleGames[`bestof${i}`] = `Best-of-${i}`;\r\n\t\t}\r\n\t\twindow.BattleFormats = {};\r\n\t\tfor (let j = 1; j < formatsList.length; j++) {\r\n\t\t\tconst entry = formatsList[j];\r\n\t\t\tif (isSection) {\r\n\t\t\t\tsection = entry;\r\n\t\t\t\tisSection = false;\r\n\t\t\t} else if (entry === ',LL') {\r\n\t\t\t\tPS.teams.usesLocalLadder = true;\r\n\t\t\t} else if (entry === '' || (entry.startsWith(',') && !isNaN(Number(entry.slice(1))))) {\r\n\t\t\t\tisSection = true;\r\n\r\n\t\t\t\tif (entry) {\r\n\t\t\t\t\tcolumn = parseInt(entry.slice(1), 10) || 0;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tlet name = entry;\r\n\t\t\t\tlet searchShow = true;\r\n\t\t\t\tlet challengeShow = true;\r\n\t\t\t\tlet tournamentShow = true;\r\n\t\t\t\tlet team: 'preset' | null = null;\r\n\t\t\t\tlet teambuilderLevel: number | null = null;\r\n\t\t\t\tlet lastCommaIndex = name.lastIndexOf(',');\r\n\t\t\t\tlet code = lastCommaIndex >= 0 ? parseInt(name.substr(lastCommaIndex + 1), 16) : NaN;\r\n\t\t\t\tif (!isNaN(code)) {\r\n\t\t\t\t\tname = name.substr(0, lastCommaIndex);\r\n\t\t\t\t\tif (code & 1) team = 'preset';\r\n\t\t\t\t\tif (!(code & 2)) searchShow = false;\r\n\t\t\t\t\tif (!(code & 4)) challengeShow = false;\r\n\t\t\t\t\tif (!(code & 8)) tournamentShow = false;\r\n\t\t\t\t\tif (code & 16) teambuilderLevel = 50;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Backwards compatibility: late 0.9.0 -> 0.10.0\r\n\t\t\t\t\tif (name.substr(name.length - 2) === ',#') { // preset teams\r\n\t\t\t\t\t\tteam = 'preset';\r\n\t\t\t\t\t\tname = name.substr(0, name.length - 2);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (name.substr(name.length - 2) === ',,') { // search-only\r\n\t\t\t\t\t\tchallengeShow = false;\r\n\t\t\t\t\t\tname = name.substr(0, name.length - 2);\r\n\t\t\t\t\t} else if (name.substr(name.length - 1) === ',') { // challenge-only\r\n\t\t\t\t\t\tsearchShow = false;\r\n\t\t\t\t\t\tname = name.substr(0, name.length - 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tlet id = toID(name);\r\n\t\t\t\tlet isTeambuilderFormat = !team && !name.endsWith('Custom Game');\r\n\t\t\t\tlet teambuilderFormat = '' as ID;\r\n\t\t\t\tlet teambuilderFormatName = '';\r\n\t\t\t\tif (isTeambuilderFormat) {\r\n\t\t\t\t\tteambuilderFormatName = name;\r\n\t\t\t\t\tif (!id.startsWith('gen')) {\r\n\t\t\t\t\t\tteambuilderFormatName = '[Gen 6] ' + name;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet parenPos = teambuilderFormatName.indexOf('(');\r\n\t\t\t\t\tif (parenPos > 0 && name.endsWith(')')) {\r\n\t\t\t\t\t\t// variation of existing tier\r\n\t\t\t\t\t\tteambuilderFormatName = teambuilderFormatName.slice(0, parenPos).trim();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (teambuilderFormatName !== name) {\r\n\t\t\t\t\t\tteambuilderFormat = toID(teambuilderFormatName);\r\n\t\t\t\t\t\tif (BattleFormats[teambuilderFormat]) {\r\n\t\t\t\t\t\t\tBattleFormats[teambuilderFormat].isTeambuilderFormat = true;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tBattleFormats[teambuilderFormat] = {\r\n\t\t\t\t\t\t\t\tid: teambuilderFormat,\r\n\t\t\t\t\t\t\t\tname: teambuilderFormatName,\r\n\t\t\t\t\t\t\t\tteam,\r\n\t\t\t\t\t\t\t\tsection,\r\n\t\t\t\t\t\t\t\tcolumn,\r\n\t\t\t\t\t\t\t\trated: false,\r\n\t\t\t\t\t\t\t\tisTeambuilderFormat: true,\r\n\t\t\t\t\t\t\t\teffectType: 'Format',\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tisTeambuilderFormat = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (BattleFormats[id]?.isTeambuilderFormat) {\r\n\t\t\t\t\tisTeambuilderFormat = true;\r\n\t\t\t\t}\r\n\t\t\t\t// make sure formats aren't out-of-order\r\n\t\t\t\tif (BattleFormats[id]) delete BattleFormats[id];\r\n\t\t\t\tBattleFormats[id] = {\r\n\t\t\t\t\tid,\r\n\t\t\t\t\tname,\r\n\t\t\t\t\tteam,\r\n\t\t\t\t\tsection,\r\n\t\t\t\t\tcolumn,\r\n\t\t\t\t\tsearchShow,\r\n\t\t\t\t\tchallengeShow,\r\n\t\t\t\t\ttournamentShow,\r\n\t\t\t\t\trated: searchShow && id.substr(4, 7) !== 'unrated',\r\n\t\t\t\t\tteambuilderLevel,\r\n\t\t\t\t\tteambuilderFormat,\r\n\t\t\t\t\tisTeambuilderFormat,\r\n\t\t\t\t\teffectType: 'Format',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Match base formats to their variants, if they are unavailable in the server.\r\n\t\tlet multivariantFormats: { [id: string]: 1 } = {};\r\n\t\tfor (let id in BattleFormats) {\r\n\t\t\tlet teambuilderFormat = BattleFormats[BattleFormats[id].teambuilderFormat!];\r\n\t\t\tif (!teambuilderFormat || multivariantFormats[teambuilderFormat.id]) continue;\r\n\t\t\tif (!teambuilderFormat.searchShow && !teambuilderFormat.challengeShow && !teambuilderFormat.tournamentShow) {\r\n\t\t\t\t// The base format is not available.\r\n\t\t\t\tif (teambuilderFormat.battleFormat) {\r\n\t\t\t\t\tmultivariantFormats[teambuilderFormat.id] = 1;\r\n\t\t\t\t\tteambuilderFormat.battleFormat = '';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tteambuilderFormat.battleFormat = id;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tPS.teams.update('format');\r\n\t}\r\n\thandlePM(user1: string, user2: string, message?: string) {\r\n\t\tconst userid1 = toID(user1);\r\n\t\tconst userid2 = toID(user2);\r\n\t\tconst pmTarget = PS.user.userid === userid1 ? user2 : user1;\r\n\t\tconst pmTargetid = PS.user.userid === userid1 ? userid2 : userid1;\r\n\t\tlet roomid = `dm-${pmTargetid}` as RoomID;\r\n\t\tif (pmTargetid === PS.user.userid) roomid = 'dm-' as RoomID;\r\n\t\tlet room = PS.rooms[roomid] as ChatRoom | undefined;\r\n\t\tif (!room) {\r\n\t\t\tPS.addRoom({\r\n\t\t\t\tid: roomid,\r\n\t\t\t\targs: { pmTarget },\r\n\t\t\t\tautofocus: false,\r\n\t\t\t});\r\n\t\t\troom = PS.rooms[roomid] as ChatRoom;\r\n\t\t} else {\r\n\t\t\troom.updateTarget(pmTarget);\r\n\t\t}\r\n\t\tif (message) room.receiveLine([`c`, user1, message]);\r\n\t\tPS.update();\r\n\t}\r\n\t/**\r\n\t * Client-to-server query. Handles `/crq` aka `/cmd`.\r\n\t *\r\n\t * Most queries are still handled hardcoded, so this is only for certain\r\n\t * special queries that need a Promise.\r\n\t */\r\n\tmakeQuery(id: string, param?: string) {\r\n\t\tlet fullid = id;\r\n\t\tif (param) fullid += ` ${toID(param)}`;\r\n\t\treturn new Promise<any>(resolve => {\r\n\t\t\tif (!this.listeners[fullid]) {\r\n\t\t\t\tthis.listeners[fullid] = [];\r\n\t\t\t\tPS.send(`/cmd ${id} ${param || ''}`);\r\n\t\t\t}\r\n\t\t\tthis.listeners[fullid]!.push(resolve);\r\n\t\t});\r\n\t}\r\n\thandleQueryResponse(id: ID, response: any) {\r\n\t\tlet fullid: string = id;\r\n\t\tswitch (id) {\r\n\t\tcase 'userdetails':\r\n\t\t\tlet userid = response.userid;\r\n\t\t\tfullid += ` ${userid}`;\r\n\t\t\tlet userdetails = this.userdetailsCache[userid];\r\n\t\t\tif (!userdetails) {\r\n\t\t\t\tthis.userdetailsCache[userid] = response;\r\n\t\t\t} else {\r\n\t\t\t\tObject.assign(userdetails, response);\r\n\t\t\t}\r\n\t\t\tPS.rooms[`user-${userid}`]?.update(null);\r\n\t\t\tPS.rooms[`viewuser-${userid}`]?.update(null);\r\n\t\t\tPS.rooms[`users`]?.update(null);\r\n\t\t\tbreak;\r\n\t\tcase 'rooms':\r\n\t\t\tif (response.pspl) {\r\n\t\t\t\tfor (const roomInfo of response.pspl) roomInfo.spotlight = \"Spotlight\";\r\n\t\t\t\tresponse.chat = [...response.pspl, ...response.chat];\r\n\t\t\t\tresponse.pspl = null;\r\n\t\t\t}\r\n\t\t\tif (response.official) {\r\n\t\t\t\tfor (const roomInfo of response.official) roomInfo.section = \"Official\";\r\n\t\t\t\tresponse.chat = [...response.official, ...response.chat];\r\n\t\t\t\tresponse.official = null;\r\n\t\t\t}\r\n\t\t\tthis.roomsCache = response;\r\n\t\t\tconst roomsRoom = PS.rooms[`rooms`] as RoomsRoom;\r\n\t\t\tif (roomsRoom) roomsRoom.update(null);\r\n\t\t\tbreak;\r\n\t\tcase 'roomlist':\r\n\t\t\tconst battlesRoom = PS.rooms[`battles`] as BattlesRoom;\r\n\t\t\tif (battlesRoom) {\r\n\t\t\t\tconst battleTable = response.rooms;\r\n\t\t\t\tconst battles = [];\r\n\t\t\t\tfor (const battleid in battleTable) {\r\n\t\t\t\t\tbattleTable[battleid].id = battleid;\r\n\t\t\t\t\tbattles.push(battleTable[battleid]);\r\n\t\t\t\t}\r\n\t\t\t\tbattlesRoom.battles = battles;\r\n\t\t\t\tbattlesRoom.update(null);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase 'laddertop':\r\n\t\t\tfor (const [roomid, ladderRoom] of Object.entries(PS.rooms)) {\r\n\t\t\t\tif (roomid.startsWith('ladder-')) {\r\n\t\t\t\t\t(ladderRoom as LadderFormatRoom).update(response);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase 'teamupload':\r\n\t\t\tif (PS.teams.uploading) {\r\n\t\t\t\tconst team = PS.teams.uploading;\r\n\t\t\t\tteam.uploaded = {\r\n\t\t\t\t\tteamid: response.teamid,\r\n\t\t\t\t\tnotLoaded: false,\r\n\t\t\t\t\tprivate: response.private,\r\n\t\t\t\t};\r\n\t\t\t\tPS.rooms[`team-${team.key}`]?.update(null);\r\n\t\t\t\tPS.rooms.teambuilder?.update(null);\r\n\t\t\t\tPS.teams.uploading = null;\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase 'teamupdate':\r\n\t\t\tfor (const team of PS.teams.list) {\r\n\t\t\t\tif (team.teamid === response.teamid) {\r\n\t\t\t\t\tteam.uploaded = {\r\n\t\t\t\t\t\tteamid: response.teamid,\r\n\t\t\t\t\t\tnotLoaded: false,\r\n\t\t\t\t\t\tprivate: response.private,\r\n\t\t\t\t\t};\r\n\t\t\t\t\tPS.rooms[`team-${team.key}`]?.update(null);\r\n\t\t\t\t\tPS.rooms.teambuilder?.update(null);\r\n\t\t\t\t\tPS.teams.uploading = null;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tfor (const callback of this.listeners[fullid] || []) callback(response);\r\n\t\tdelete this.listeners[fullid];\r\n\t}\r\n}\r\n\r\nclass NewsPanel extends PSRoomPanel {\r\n\tstatic readonly id = 'news';\r\n\tstatic readonly routes = ['news'];\r\n\tstatic readonly title = 'News';\r\n\tstatic readonly location = 'mini-window';\r\n\tchange = (ev: Event) => {\r\n\t\tconst target = ev.currentTarget as HTMLInputElement;\r\n\t\tif (target.value === '1') {\r\n\t\t\tdocument.cookie = \"preactalpha=1; expires=Thu, 1 Jan 2026 12:00:00 UTC; path=/\";\r\n\t\t} else {\r\n\t\t\tdocument.cookie = \"preactalpha=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;\";\r\n\t\t}\r\n\t\tif (target.value === 'leave') {\r\n\t\t\tdocument.location.href = `/`;\r\n\t\t}\r\n\t};\r\n\toverride render() {\r\n\t\tconst cookieSet = document.cookie.includes('preactalpha=1');\r\n\t\treturn <PSPanelWrapper room={this.props.room} fullSize scrollable>\r\n\t\t\t<div class=\"construction\">\r\n\t\t\t\tThis is the client rewrite beta test.\r\n\t\t\t\t<form>\r\n\t\t\t\t\t<label class=\"checkbox\">\r\n\t\t\t\t\t\t<input type=\"radio\" name=\"preactalpha\" value=\"1\" onChange={this.change} checked={cookieSet} /> {}\r\n\t\t\t\t\t\tUse Rewrite always\r\n\t\t\t\t\t</label>\r\n\t\t\t\t\t<label class=\"checkbox\">\r\n\t\t\t\t\t\t<input type=\"radio\" name=\"preactalpha\" value=\"0\" onChange={this.change} checked={!cookieSet} /> {}\r\n\t\t\t\t\t\tUse Rewrite with URL\r\n\t\t\t\t\t</label>\r\n\t\t\t\t\t<label class=\"checkbox\">\r\n\t\t\t\t\t\t<input type=\"radio\" name=\"preactalpha\" value=\"leave\" onChange={this.change} /> {}\r\n\t\t\t\t\t\tBack to the old client\r\n\t\t\t\t\t</label>\r\n\t\t\t\t</form>\r\n\t\t\t\tProvide feedback in <a href=\"development\" style=\"color:black\">the Dev chatroom</a>.\r\n\t\t\t</div>\r\n\t\t\t<div class=\"readable-bg\" dangerouslySetInnerHTML={{ __html: PS.newsHTML }}></div>\r\n\t\t</PSPanelWrapper>;\r\n\t}\r\n}\r\n\r\nclass MainMenuPanel extends PSRoomPanel<MainMenuRoom> {\r\n\tstatic readonly id = 'mainmenu';\r\n\tstatic readonly routes = [''];\r\n\tstatic readonly Model = MainMenuRoom;\r\n\tstatic readonly icon = <i class=\"fa fa-home\" aria-hidden></i>;\r\n\toverride focus() {\r\n\t\tthis.base?.querySelector<HTMLButtonElement>('.formatselect')?.focus();\r\n\t}\r\n\tsubmitSearch = (ev: Event, format: string, team?: Team) => {\r\n\t\tif (!PS.user.named) {\r\n\t\t\tPS.join('login' as RoomID, {\r\n\t\t\t\tparentElem: this.base!.querySelector<HTMLElement>('.big.button'),\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tPS.mainmenu.startSearch(format, team, ev.target as HTMLElement);\r\n\t};\r\n\thandleDragStart = (e: DragEvent) => {\r\n\t\tconst room = PS.getRoom(e.currentTarget);\r\n\t\tif (!room) return;\r\n\t\tconst foreground = (PS.leftPanel.id === room.id || PS.rightPanel?.id === room.id);\r\n\t\tPS.dragging = { type: 'room', roomid: room.id, foreground };\r\n\t};\r\n\thandleDragEnter = (e: DragEvent) => {\r\n\t\t// console.log('dragenter ' + e.dataTransfer!.dropEffect);\r\n\t\te.preventDefault();\r\n\t\tif (PS.dragging?.type !== 'room') return;\r\n\t\tconst draggingRoom = PS.dragging.roomid;\r\n\t\tif (draggingRoom === null) return;\r\n\r\n\t\tconst draggedOverRoom = PS.getRoom(e.target as HTMLElement);\r\n\t\tif (draggingRoom === draggedOverRoom?.id) return;\r\n\r\n\t\tconst index = PS.miniRoomList.indexOf(draggedOverRoom?.id as any);\r\n\t\tif (index >= 0) {\r\n\t\t\tPS.dragOnto(PS.rooms[draggingRoom]!, 'mini-window', index);\r\n\t\t} else if (PS.rooms[draggingRoom]?.location !== 'mini-window') {\r\n\t\t\tPS.dragOnto(PS.rooms[draggingRoom]!, 'mini-window', 0);\r\n\t\t}\r\n\r\n\t\t// dropEffect !== 'none' prevents bounce-back animation in\r\n\t\t// Chrome/Safari/Opera\r\n\t\t// if (e.dataTransfer) e.dataTransfer.dropEffect = 'move';\r\n\t};\r\n\trenderMiniRoom(room: PSRoom) {\r\n\t\tconst RoomType = PS.roomTypes[room.type];\r\n\t\tconst Panel = RoomType || PSRoomPanel;\r\n\t\treturn <Panel key={room.id} room={room} />;\r\n\t}\r\n\thandleClickMinimize = (e: MouseEvent) => {\r\n\t\tif ((e.target as Element)?.getAttribute('data-cmd')) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (((e.target as Element)?.parentNode as Element)?.getAttribute('data-cmd')) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst room = PS.getRoom(e.currentTarget);\r\n\t\tif (room) {\r\n\t\t\troom.minimized = !room.minimized;\r\n\t\t\tthis.forceUpdate();\r\n\t\t}\r\n\t};\r\n\trenderMiniRooms() {\r\n\t\treturn PS.miniRoomList.map(roomid => {\r\n\t\t\tconst room = PS.rooms[roomid]!;\r\n\t\t\tconst notifying = room.notifications.length ? ' notifying' : room.isSubtleNotifying ? ' subtle-notifying' : '';\r\n\t\t\treturn <div\r\n\t\t\t\tclass={`mini-window${room.minimized ? ' collapsed' : ''}${room === PS.room ? ' focused' : ''}`}\r\n\t\t\t\tkey={roomid} data-roomid={roomid}\r\n\t\t\t>\r\n\t\t\t\t<h3\r\n\t\t\t\t\tclass={`mini-window-header${notifying}`} draggable onDragStart={this.handleDragStart} onClick={this.handleClickMinimize}\r\n\t\t\t\t>\r\n\t\t\t\t\t<button class=\"closebutton\" data-cmd=\"/close\" aria-label=\"Close\" tabIndex={-1}>\r\n\t\t\t\t\t\t<i class=\"fa fa-times-circle\" aria-hidden></i>\r\n\t\t\t\t\t</button>\r\n\t\t\t\t\t<button class=\"maximizebutton\" data-cmd=\"/maximize\" tabIndex={-1} aria-label=\"Maximize\">\r\n\t\t\t\t\t\t<i class=\"fa fa-stop-circle\" aria-hidden></i>\r\n\t\t\t\t\t</button>\r\n\t\t\t\t\t<button class=\"minimizebutton\" tabIndex={-1} aria-label=\"Expand/Collapse\">\r\n\t\t\t\t\t\t<i class=\"fa fa-minus-circle\" aria-hidden></i>\r\n\t\t\t\t\t</button>\r\n\t\t\t\t\t{room.title}\r\n\t\t\t\t</h3>\r\n\t\t\t\t{this.renderMiniRoom(room)}\r\n\t\t\t</div>;\r\n\t\t});\r\n\t}\r\n\trenderGames() {\r\n\t\tif (!PS.mainmenu.search.games) return null;\r\n\r\n\t\t// This does not use the word \"game\" because it includes things like help tickets\r\n\t\treturn <div class=\"menugroup\">\r\n\t\t\t<p class=\"label\">You are in:</p>\r\n\t\t\t{Object.entries(PS.mainmenu.search.games).map(([roomid, gameName]) => <div>\r\n\t\t\t\t<a class=\"blocklink\" href={`${roomid}`}>{gameName}</a>\r\n\t\t\t</div>)}\r\n\t\t</div>;\r\n\t}\r\n\trenderSearchButton() {\r\n\t\tif (PS.down) {\r\n\t\t\treturn <div class=\"menugroup\" style=\"background: rgba(10,10,10,.6)\">\r\n\t\t\t\t{PS.down === 'ddos' ? (\r\n\t\t\t\t\t<p class=\"error\"><strong>Pok&eacute;mon Showdown is offline due to a DDoS attack!</strong></p>\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<p class=\"error\"><strong>Pok&eacute;mon Showdown is offline due to technical difficulties!</strong></p>\r\n\t\t\t\t)}\r\n\t\t\t\t<p>\r\n\t\t\t\t\t<div style={{ textAlign: 'center' }}>\r\n\t\t\t\t\t\t<img width=\"96\" height=\"96\" src={`//${Config.routes.client}/sprites/gen5/teddiursa.png`} alt=\"\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\tBear with us as we freak out.\r\n\t\t\t\t</p>\r\n\t\t\t\t<p>(We'll be back up in a few hours.)</p>\r\n\t\t\t</div>;\r\n\t\t}\r\n\r\n\t\tif (!PS.user.userid || PS.isOffline) {\r\n\t\t\treturn <TeamForm class=\"menugroup\" onSubmit={this.submitSearch} selectType=\"search\">\r\n\t\t\t\t<button class=\"mainmenu1 mainmenu big button disabled\" disabled name=\"search\">\r\n\t\t\t\t\t<em>{PS.isOffline ? [<span class=\"fa-stack fa-lg\">\r\n\t\t\t\t\t\t<i class=\"fa fa-plug fa-flip-horizontal fa-stack-1x\" aria-hidden></i>\r\n\t\t\t\t\t\t<i class=\"fa fa-ban fa-stack-2x text-danger\" aria-hidden></i>\r\n\t\t\t\t\t</span>, \" Disconnected\"] : \"Connecting...\"}</em>\r\n\t\t\t\t</button>\r\n\t\t\t\t{PS.isOffline && <p class=\"buttonbar\">\r\n\t\t\t\t\t<button class=\"button\" data-cmd=\"/reconnect\">\r\n\t\t\t\t\t\t<i class=\"fa fa-plug\" aria-hidden></i> <strong>Reconnect</strong>\r\n\t\t\t\t\t</button> {}\r\n\t\t\t\t\t{PS.connection?.reconnectTimer && <small>(Autoreconnect in {Math.round(PS.connection.reconnectDelay / 1000)}s)</small>}\r\n\t\t\t\t</p>}\r\n\t\t\t</TeamForm>;\r\n\t\t}\r\n\r\n\t\treturn <TeamForm\r\n\t\t\tclass=\"menugroup\" format={PS.mainmenu.searchingFormat() || undefined}\r\n\t\t\tselectType=\"search\" onSubmit={this.submitSearch}\r\n\t\t>\r\n\t\t\t<p>\r\n\t\t\t\t<button class=\"button small\" data-href=\"battleoptions\" title=\"Options\" aria-label=\"Options\">\r\n\t\t\t\t\tBattle options <i class=\"fa fa-caret-down\"></i>\r\n\t\t\t\t</button></p>\r\n\t\t\t{PS.mainmenu.searchCountdown ? (\r\n\t\t\t\t<>\r\n\t\t\t\t\t<button class=\"mainmenu1 mainmenu big button disabled\" type=\"submit\"><strong>\r\n\t\t\t\t\t\t<i class=\"fa fa-refresh fa-spin\" aria-hidden></i> Searching in {PS.mainmenu.searchCountdown.countdown}...\r\n\t\t\t\t\t</strong></button>\r\n\t\t\t\t\t<p class=\"buttonbar\"><button class=\"button\" data-cmd=\"/cancelsearch\">Cancel</button></p>\r\n\t\t\t\t</>\r\n\t\t\t) : PS.mainmenu.searchingFormat() ? (\r\n\t\t\t\t<>\r\n\t\t\t\t\t<button class=\"mainmenu1 mainmenu big button disabled\" type=\"submit\">\r\n\t\t\t\t\t\t<strong><i class=\"fa fa-refresh fa-spin\" aria-hidden></i> Searching...</strong>\r\n\t\t\t\t\t</button>\r\n\t\t\t\t\t<p class=\"buttonbar\"><button class=\"button\" data-cmd=\"/cancelsearch\">Cancel</button></p>\r\n\t\t\t\t</>\r\n\t\t\t) : (\r\n\t\t\t\t<button class=\"mainmenu1 mainmenu big button\" type=\"submit\">\r\n\t\t\t\t\t<strong>Battle!</strong><br />\r\n\t\t\t\t\t<small>Find a random opponent</small>\r\n\t\t\t\t</button>\r\n\t\t\t)}\r\n\t\t</TeamForm>;\r\n\t}\r\n\toverride render() {\r\n\t\tconst onlineButton = ' button' + (PS.isOffline ? ' disabled' : '');\r\n\t\tconst tinyLayout = this.props.room.width < 620 ? ' tiny-layout' : '';\r\n\t\treturn <PSPanelWrapper room={this.props.room} scrollable onDragEnter={this.handleDragEnter}>\r\n\t\t\t<div class={`mainmenu-mini-windows${tinyLayout}`}>\r\n\t\t\t\t{this.renderMiniRooms()}\r\n\t\t\t</div>\r\n\t\t\t<div class={`mainmenu${tinyLayout}`}>\r\n\t\t\t\t<div class=\"mainmenu-left\">\r\n\t\t\t\t\t{this.renderGames()}\r\n\r\n\t\t\t\t\t{this.renderSearchButton()}\r\n\r\n\t\t\t\t\t<div class=\"menugroup\">\r\n\t\t\t\t\t\t<p><a class=\"mainmenu2 mainmenu button\" href=\"teambuilder\">Teambuilder</a></p>\r\n\t\t\t\t\t\t<p><a class={\"mainmenu3 mainmenu\" + onlineButton} href=\"ladder\">Ladder</a></p>\r\n\t\t\t\t\t\t<p><a class={\"mainmenu4 mainmenu\" + onlineButton} href=\"view-tournaments-all\">Tournaments</a></p>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div class=\"menugroup\">\r\n\t\t\t\t\t\t<p><a class={\"mainmenu4 mainmenu\" + onlineButton} href=\"battles\">Watch a battle</a></p>\r\n\t\t\t\t\t\t<p><a class={\"mainmenu5 mainmenu\" + onlineButton} href=\"users\">Find a user</a></p>\r\n\t\t\t\t\t\t<p><a class={\"mainmenu6 mainmenu\" + onlineButton} href=\"view-friends-all\">Friends</a></p>\r\n\t\t\t\t\t\t<p><a class={\"mainmenu7 mainmenu\" + onlineButton} href=\"resources\">Info & Resources</a></p>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"mainmenu-right\" style={{ display: PS.leftPanelWidth ? 'none' : 'block' }}>\r\n\t\t\t\t\t<div class=\"menugroup\">\r\n\t\t\t\t\t\t<p><a class={\"mainmenu1 mainmenu\" + onlineButton} href=\"rooms\">Chat rooms</a></p>\r\n\t\t\t\t\t\t{PS.server.id !== 'showdown' && (\r\n\t\t\t\t\t\t\t<p><a class={\"mainmenu2 mainmenu\" + onlineButton} href=\"lobby\">Lobby chat</a></p>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"mainmenu-footer\">\r\n\t\t\t\t\t<div class=\"bgcredit\"></div>\r\n\t\t\t\t\t<small>\r\n\t\t\t\t\t\t<a href={`//${Config.routes.dex}/`} target=\"_blank\">Pok&eacute;dex</a> | {}\r\n\t\t\t\t\t\t<a href={`//${Config.routes.replays}/`} target=\"_blank\">Replays</a> | {}\r\n\t\t\t\t\t\t<a href={`//${Config.routes.root}/rules`} target=\"_blank\">Rules</a> | {}\r\n\t\t\t\t\t\t<a href={`//${Config.routes.root}/credits`} target=\"_blank\">Credits</a> | {}\r\n\t\t\t\t\t\t<a href=\"//smogon.com/forums/\" target=\"_blank\">Forum</a>\r\n\t\t\t\t\t</small>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</PSPanelWrapper>;\r\n\t}\r\n}\r\n\r\nexport class FormatDropdown extends preact.Component<{\r\n\tselectType?: SelectType, format?: string, defaultFormat?: string, placeholder?: string,\r\n\tonChange?: JSX.EventHandler<Event>,\r\n}> {\r\n\tdeclare base?: HTMLButtonElement;\r\n\tformat = '';\r\n\tchange = (e: Event) => {\r\n\t\tif (!this.base) return;\r\n\t\tthis.format = this.base.value;\r\n\t\tthis.forceUpdate();\r\n\t\tif (this.props.onChange) this.props.onChange(e);\r\n\t};\r\n\trender() {\r\n\t\tthis.format = this.props.format || this.format || this.props.defaultFormat || '';\r\n\t\tlet [formatName, customRules] = this.format.split('@@@');\r\n\t\tif (window.BattleLog) formatName = BattleLog.formatName(formatName);\r\n\t\tif (this.props.format && !this.props.onChange) {\r\n\t\t\t// There's intentionally no `disabled` prop. If this is out of sync\r\n\t\t\t// with the `format` and `onChange` props, that's a bug.\r\n\t\t\treturn <button\r\n\t\t\t\tname=\"format\" value={this.format} class=\"select formatselect preselected\" disabled\r\n\t\t\t>\r\n\t\t\t\t{formatName}\r\n\t\t\t\t{!!customRules && [<br />, <small>Custom rules: {customRules}</small>]}\r\n\t\t\t</button>;\r\n\t\t}\r\n\t\treturn <button\r\n\t\t\tname=\"format\" value={this.format} data-selecttype={this.props.selectType}\r\n\t\t\tclass=\"select formatselect\" data-href=\"/formatdropdown\" onChange={this.change}\r\n\t\t>\r\n\t\t\t{formatName || (!!this.props.placeholder && <em>{this.props.placeholder}</em>) || null}\r\n\t\t\t{!!customRules && [<br />, <small>Custom rules: {customRules}</small>]}\r\n\t\t</button>;\r\n\t}\r\n}\r\n\r\nclass TeamDropdown extends preact.Component<{ format: string }> {\r\n\tteamFormat = '';\r\n\tteamKey = '';\r\n\tchange = () => {\r\n\t\tif (!this.base) return;\r\n\t\tthis.teamKey = (this.base as HTMLButtonElement).value;\r\n\t\tthis.forceUpdate();\r\n\t};\r\n\tgetDefaultTeam(teambuilderFormat: string) {\r\n\t\tfor (const team of PS.teams.list) {\r\n\t\t\tif (team.format === teambuilderFormat) return team.key;\r\n\t\t}\r\n\t\treturn '';\r\n\t}\r\n\trender() {\r\n\t\tconst teamFormat = PS.teams.teambuilderFormat(this.props.format);\r\n\t\tconst formatData = window.BattleFormats?.[teamFormat];\r\n\t\tif (formatData?.team) {\r\n\t\t\treturn <button class=\"select teamselect preselected\" name=\"team\" value=\"random\" disabled>\r\n\t\t\t\t<div class=\"team\">\r\n\t\t\t\t\t<strong>Random team</strong>\r\n\t\t\t\t\t<small>\r\n\t\t\t\t\t\t<PSIcon pokemon={null} />\r\n\t\t\t\t\t\t<PSIcon pokemon={null} />\r\n\t\t\t\t\t\t<PSIcon pokemon={null} />\r\n\t\t\t\t\t\t<PSIcon pokemon={null} />\r\n\t\t\t\t\t\t<PSIcon pokemon={null} />\r\n\t\t\t\t\t\t<PSIcon pokemon={null} />\r\n\t\t\t\t\t</small>\r\n\t\t\t\t</div>\r\n\t\t\t</button>;\r\n\t\t}\r\n\t\tif (teamFormat !== this.teamFormat) {\r\n\t\t\tthis.teamFormat = teamFormat;\r\n\t\t\tthis.teamKey = this.getDefaultTeam(teamFormat);\r\n\t\t}\r\n\t\tconst team = PS.teams.byKey[this.teamKey] || null;\r\n\t\treturn <button\r\n\t\t\tname=\"team\" value={this.teamKey}\r\n\t\t\tclass=\"select teamselect\" data-href=\"/teamdropdown\" data-format={teamFormat} onChange={this.change}\r\n\t\t>\r\n\t\t\t{PS.roomTypes['teamdropdown'] && <TeamBox team={team} noLink />}\r\n\t\t</button>;\r\n\t}\r\n}\r\n\r\nexport class TeamForm extends preact.Component<{\r\n\tchildren: preact.ComponentChildren,\r\n\tclass?: string, format?: string, teamFormat?: string, hideFormat?: boolean, selectType?: SelectType,\r\n\tdefaultFormat?: string,\r\n\tonSubmit: ((e: Event, format: string, team?: Team) => void) | null,\r\n\tonValidate?: ((e: Event, format: string, team?: Team) => void) | null,\r\n}> {\r\n\tformat = '';\r\n\tchangeFormat = (ev: Event) => {\r\n\t\tthis.format = (ev.target as HTMLButtonElement).value;\r\n\t};\r\n\tsubmit = (ev: Event, validate?: 'validate') => {\r\n\t\tev.preventDefault();\r\n\t\tconst format = this.format;\r\n\t\tconst teamElement = this.base!.querySelector<HTMLButtonElement>('button[name=team]');\r\n\t\tconst teamKey = teamElement!.value;\r\n\t\tconst team = teamKey ? PS.teams.byKey[teamKey] : undefined;\r\n\t\tif (!window.BattleFormats[PS.teams.teambuilderFormat(format)]?.team && !team) {\r\n\t\t\tPS.alert('You need to go into the Teambuilder and build a team for this format.', {\r\n\t\t\t\tparentElem: teamElement!,\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tPS.teams.loadTeam(team).then(() => {\r\n\t\t\t(validate === 'validate' ? this.props.onValidate : this.props.onSubmit)?.(ev, format, team);\r\n\t\t});\r\n\t};\r\n\thandleClick = (ev: Event) => {\r\n\t\tlet target = ev.target as HTMLButtonElement | null;\r\n\t\twhile (target && target !== this.base) {\r\n\t\t\tif (target.tagName === 'BUTTON' && target.name === 'validate') {\r\n\t\t\t\tthis.submit(ev, 'validate');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\ttarget = target.parentNode as HTMLButtonElement | null;\r\n\t\t}\r\n\t};\r\n\trender() {\r\n\t\tif (window.BattleFormats) {\r\n\t\t\tthis.format ||= this.props.defaultFormat || '';\r\n\t\t\tif (!this.format) {\r\n\t\t\t\tthis.format = `gen${Dex.gen}randombattle`;\r\n\r\n\t\t\t\tconst starredPrefs = PS.prefs.starredformats || {};\r\n\t\t\t\t// .reverse() because the newest starred format should be the default one\r\n\t\t\t\tconst starred = Object.keys(starredPrefs).filter(id => starredPrefs[id] === true).reverse();\r\n\t\t\t\tfor (let id of starred) {\r\n\t\t\t\t\tlet format = window.BattleFormats[id];\r\n\t\t\t\t\tif (!format) continue;\r\n\t\t\t\t\tif (this.props.selectType === 'challenge' && format?.challengeShow === false) continue;\r\n\t\t\t\t\tif (this.props.selectType === 'search' && format?.searchShow === false) continue;\r\n\t\t\t\t\tif (this.props.selectType === 'teambuilder' && format?.team) continue;\r\n\t\t\t\t\tthis.format = id;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this.props.defaultFormat?.startsWith('!!')) {\r\n\t\t\t// The !! means that it overrides any current format, and will only be\r\n\t\t\t// sent as a prop once\r\n\t\t\tthis.format = this.props.defaultFormat.slice(2);\r\n\t\t}\r\n\t\tif (this.props.format) this.format = this.props.format;\r\n\r\n\t\treturn <form class={this.props.class} onSubmit={this.submit} onClick={this.handleClick}>\r\n\t\t\t{!this.props.hideFormat && <p>\r\n\t\t\t\t<label class=\"label\">\r\n\t\t\t\t\tFormat:<br />\r\n\t\t\t\t\t<FormatDropdown\r\n\t\t\t\t\t\tselectType={this.props.selectType} format={this.format}\r\n\t\t\t\t\t\tonChange={this.props.format ? undefined : this.changeFormat}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</label>\r\n\t\t\t</p>}\r\n\t\t\t<p>\r\n\t\t\t\t<label class=\"label\">\r\n\t\t\t\t\tTeam:<br />\r\n\t\t\t\t\t<TeamDropdown format={this.props.teamFormat || this.format} />\r\n\t\t\t\t</label>\r\n\t\t\t</p>\r\n\t\t\t<p>{this.props.children}</p>\r\n\t\t</form>;\r\n\t}\r\n}\r\n\r\nPS.addRoomType(NewsPanel, MainMenuPanel);\r\n"],"mappings":"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","ignoreList":[]}